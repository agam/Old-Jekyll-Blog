
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Agam's Mashed-Up Pome</title>
	<meta name="author" content="Agam">

	
	<meta name="description" content="It all started when I wanted to &ldquo;relearn&rdquo; C++. I use it everyday, but it&rsquo;s been so long since I first came across it 15 years ago &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Agam's Mashed-Up Pome" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>

</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Agam's Mashed-Up Pome</a></h1>
<!-- DebugAgam: Uncomment if necessary!
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:agam.github.io">
			</form>
		</div>
	</div>
</nav>
-->
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		<a class="google" href="https://plus.google.com/+AgamBrahma?rel=author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/agambrahma" title="Twitter">Twitter</a>
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
        <!-- DebugAgam: uncomment if necessary!
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:agam.github.io">
	</form>
        -->
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/08/26/building-boost-clang-gcc/">
		
			In Which I Recall How to Build Stuff</a>
	</h2>
	<div class="entry-content">
		<p>It all started when I wanted to &ldquo;relearn&rdquo; C++. I use it everyday, but it&rsquo;s been so long since I first came across it 15 years ago that I&rsquo;ve accumulated tons of bad habits and thought patterns etc, so I wanted to get a &ldquo;beginner&rsquo;s mind&rdquo; feel of it again.</p>

<h2>The initial detour</h2>

<p>Ok, I thought, let&rsquo;s read the <a href="http://www.amazon.com/The-Programming-Language-3rd-Edition/dp/0201889544">4th edition</a> of Bjarne&rsquo;s introduction to C++, and meanwhile also get to know <a href="http://www.boost.org/">Boost</a> with some familiarity.</p>

<p>So I downloaded the <a href="http://sourceforge.net/projects/boost/files/boost/1.54.0/boost_1_54_0.tar.bz2/download">Boost libraries</a> (which took a while), and then tried to build this basic example (from the Boost FAQ)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'><span class="cp">#include &lt;algorithm&gt;</span>
</span><span class='line'><span class="cp">#include &lt;iterator&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">using</span> <span class="n">boost</span><span class="o">::</span><span class="n">lambda</span><span class="o">::</span><span class="n">_1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">istream_iterator</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">in</span><span class="p">;</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span>
</span><span class='line'>      <span class="n">in</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">),</span> <span class="n">in</span><span class="p">(),</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">_1</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>using Clang</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>clang -std<span class="o">=</span>c++11 -stdlib<span class="o">=</span>libc++ -I/opt/boost/boost_1_54_0 example.cc -o example
</span></code></pre></td></tr></table></div></figure>


<h2>Fork in the road</h2>

<p>No luck</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>/tmp/example-oWquCX.o: In <span class="k">function</span> <span class="sb">`</span>__cxx_global_var_init3<span class="s1">&#39;:</span>
</span><span class='line'><span class="s1">example.cc:(.text+0x71): undefined reference to `std::ios_base::Init::Init()&#39;</span>
</span><span class='line'>example.cc:<span class="o">(</span>.text+0x79<span class="o">)</span>: undefined reference to <span class="sb">`</span>std::ios_base::Init::~Init<span class="o">()</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">/tmp/example-oWquCX.o: In function `main&#39;</span>:
</span><span class='line'>example.cc:<span class="o">(</span>.text+0xb3<span class="o">)</span>: undefined reference to <span class="sb">`</span>std::cin<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">example.cc:(.text+0xf0): undefined reference to `std::cout&#39;</span>
</span><span class='line'>/tmp/example-oWquCX.o: In <span class="k">function</span> <span class="sb">`</span>std::istream_iterator&lt;int, char, std::char_traits&lt;char&gt;, long&gt;::_M_read<span class="o">()</span><span class="err">&#39;</span>:
</span></code></pre></td></tr></table></div></figure>


<p>(and more that I&rsquo;ll skip over right now).</p>

<p>Later I realized that this was probably my fault in not linking it correctly, but I immediately, inexplicably, decided &ldquo;Aha! let&rsquo;s build clang from source!&rdquo;</p>

<p>This might also have been because I had gotten bored of <code>sudo apt-get install foo</code> and longed for the (decade ago) days of <code>emerge foo</code>.</p>

<h2>Deep in the woods</h2>

<p>Luckily, this turned out to be <a href="http://solarianprogrammer.com/2013/01/17/building-clang-libcpp-ubuntu-linux/">well-documented</a>, more or less.</p>

<p>So I got up to the point where I got and built <code>clang</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>svn co http://llvm.org/svn/llvm-project/llvm/trunk llvm
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>llvm/tools
</span><span class='line'><span class="nv">$ </span>svn co http://llvm.org/svn/llvm-project/cfe/trunk clang
</span><span class='line'><span class="nv">$ </span>mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd </span>build
</span><span class='line'><span class="nv">$ </span>../llvm/configure --prefix<span class="o">=</span>/usr/clang_3_3 <span class="se">\</span>
</span><span class='line'>  --enable-optimized --enable-targets<span class="o">=</span>host
</span><span class='line'><span class="nv">$ </span>make -j 8
</span></code></pre></td></tr></table></div></figure>


<p>And I procedded to then build <code>libcxx</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>svn co http://llvm.org/svn/llvm-project/libcxx/trunk libcxx
</span><span class='line'><span class="nv">$ </span>mkdir build_libcxx <span class="o">&amp;&amp;</span> <span class="nb">cd </span>build_libcxx
</span><span class='line'><span class="nv">$ CC</span><span class="o">=</span>clang <span class="nv">CXX</span><span class="o">=</span>clang++ cmake -G <span class="s2">&quot;Unix Makefiles&quot;</span> <span class="se">\</span>
</span><span class='line'>  -DLIBCXX_CXX_ABI<span class="o">=</span>libsupc++ <span class="se">\</span>
</span><span class='line'>  -DLIBCXX_LIBSUPCXX_INCLUDE_PATHS<span class="o">=</span><span class="s2">&quot;/usr/include/c++/4.6/;\</span>
</span><span class='line'><span class="s2">  /usr/include/c++/4.6/x86_64-linux-gnu/&quot;</span> <span class="se">\</span>
</span><span class='line'>  -DCMAKE_BUILD_TYPE<span class="o">=</span>Release -DCMAKE_INSTALL_PREFIX<span class="o">=</span>/usr <span class="nv">$HOME</span>/Clang/libcxx
</span><span class='line'><span class="nv">$ </span>make
</span></code></pre></td></tr></table></div></figure>


<h2>Mt. Doom</h2>

<p>At this point I got a compiler error. Very sad. Too bad, I thought, we need to go deeper. Time for building <code>gcc</code>/<code>g++</code> and a new version of the C++ standard library. My Ubuntu version only had <code>gcc</code> upto <code>4.6</code>, and I found <a href="http://lists.cs.uiuc.edu/pipermail/llvmbugs/2013-February/027116.html">a mailing list post</a> which suggested this might be fixed in <code>4.7</code>.</p>

<p>I could have at this point decided to add a PPA repository and got the new libraries and binaries that way, but luckily this was <a href="http://solarianprogrammer.com/2012/04/13/building-gcc-4-7-on-ubuntu-12-04/">also well-documented</a> (thank you, &ldquo;Solarian Programmer&rdquo;, whoever you are!).</p>

<p>So I went ahead and downloaded <a href="http://www.netgull.com/gcc/releases/gcc-4.7.3/gcc-4.7.3.tar.bz2"><code>gcc</code></a>, and what turned out to be its prerequisites, <a href="ftp://ftp.gmplib.org/pub/gmp-5.1.2/gmp-5.1.2.tar.lz"><code>gmp</code></a>, <a href="http://www.mpfr.org/mpfr-current/mpfr-3.1.2.tar.gz"><code>mpfr</code></a> and <a href="http://www.multiprecision.org/mpc/download/mpc-1.0.tar.gz"><code>mpc</code></a>.</p>

<p>These I built in the usual way (<code>configure</code>, <code>make</code>, <code>make install</code>), and then had to refer to them while setting up <code>gcc</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/usr/gcc_4_7/lib:<span class="nv">$LD_LIBRARY_PATH</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">LIBRARY_PATH</span><span class="o">=</span>/usr/lib/x86_64-linux-gnu/
</span><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">C_INCLUDE_PATH</span><span class="o">=</span>/usr/include/x86_64-linux-gnu
</span><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">CPLUS_INCLUDE_PATH</span><span class="o">=</span>/usr/include/x86_64-linux-gnu
</span><span class='line'><span class="nv">$ </span>../gcc-4.7.2/configure --build<span class="o">=</span>x86_64-linux-gnu --prefix<span class="o">=</span>/usr/gcc_4_7 <span class="se">\</span>
</span><span class='line'>  --with-gmp<span class="o">=</span>/usr/gcc_4_7 --with-mpfr<span class="o">=</span>/usr/gcc_4_7 <span class="se">\</span>
</span><span class='line'>  --with-mpc<span class="o">=</span>/usr/gcc_4_7 --enable-checking<span class="o">=</span>release <span class="se">\</span>
</span><span class='line'>  --enable-languages<span class="o">=</span>c,c++,fortran --disable-multilib <span class="se">\</span>
</span><span class='line'>  --program-suffix<span class="o">=</span>-4.7
</span></code></pre></td></tr></table></div></figure>


<p>Now I could proceed where I left off earlier, with the <code>libcxx</code> build, after setting a couple of path variables:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/usr/gcc_4_7/bin:<span class="nv">$PATH</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/usr/gcc_4_7/lib:/usr/gcc_4_7/lib64:<span class="nv">$LD_LIBRARY_PATH</span>
</span></code></pre></td></tr></table></div></figure>


<h2>A ray of hope</h2>

<p>But first, I wanted to see if the new <code>g++</code> could do what I had initially tried to do with <code>clang</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>g++4.7 -std<span class="o">=</span>c++11 -I/opt/boost/boost_1_54_0 example.cc -o example
</span><span class='line'><span class="nv">$ </span><span class="nb">echo </span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="p">|</span> ./example
</span><span class='line'><span class="m">3</span> <span class="m">6</span> 9
</span></code></pre></td></tr></table></div></figure>


<p>Whew, now I was getting somewhere.</p>

<p>I went back and re-ran <code>cmake</code>, and then <code>libcxx</code> built successfully.</p>

<p>And then of course, I retried my original example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>/usr/clang_3_3/bin/clang++ -std<span class="o">=</span>c++11 -I/opt/boost/boost_1_54_0 example.cc -o example
</span></code></pre></td></tr></table></div></figure>


<p>and that worked too &hellip; Woohoo!!</p>

<p>Finally, since I always measure running time:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">time</span> /usr/clang_3_3/bin/clang++ -std<span class="o">=</span>c++11 -I/opt/boost/boost_1_54_0 example.cc -o example
</span><span class='line'>
</span><span class='line'>real    0m0.848s
</span><span class='line'>user    0m0.780s
</span><span class='line'>sys     0m0.056s
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span><span class="nb">time </span>g++4.7 -std<span class="o">=</span>c++11 -I/opt/boost/boost_1_54_0 example.cc -o example
</span><span class='line'>
</span><span class='line'>real    0m0.714s
</span><span class='line'>user    0m0.648s
</span><span class='line'>sys     0m0.044s
</span></code></pre></td></tr></table></div></figure>


<p>Now to do something more than this example program &hellip;</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-08-26T00:00:00+00:00" pubdate data-updated="true">Aug 26<sup>th</sup>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/boost/'>boost</a>, <a class='category' href='/blog/categories/c-plus-plus/'>c++</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/08/14/switching-to-kde/">
		
			Switching to KDE</a>
	</h2>
	<div class="entry-content">
		<p>I have been using <a href="http://xmonad.org/">Xmonad</a> for almost a couple of years, mostly because I wanted a tiling window manager that would maximize screen space and allow fast window and desktop switching on my linux laptop.</p>

<p>Recently, I decided to go back to a full-fledged desktop environment again, and I (randomly (please, no &ldquo;Gnome vs Kde&rdquo; flamewar)) picked KDE. The last time I used it was maybe 8 years ago (!), and I was eager to see what I had been missing.</p>

<p>It seems to have gotten better in the same sense that all linux software has gotten better in the last several years (and the machine I&rsquo;m running it on has gotten much faster too!), but I particularly liked the idea of <a href="http://userbase.kde.org/Plasma#Activities">Activities</a>, being somewhat orthogonal to the idea of multiple desktops, and I found it useful to add &ldquo;work&rdquo;, &ldquo;browsing&rdquo;, &ldquo;writing&rdquo; etc areas.</p>

<h2>Minor tweaks</h2>

<p>I had to change the screen rotation of one of my monitors at my desktop, but this was fairly straightforward: [System Settings] &ndash;> [Display &amp; Monitor] &ndash;> [Size &amp; Orientation]</p>

<p>I also always get rid of the useless Caps Lock: [System Settings] &ndash;> [Input Devices] &ndash;> [Keyboard]</p>

<p>There&rsquo;s one issue which I&rsquo;m not quite sure about &mdash; I encountered a <code>no d-bus daemon running</code> message, which I fixed by <code>export $(dbus-launch)</code>, and I haven&rsquo;t encountered it since, but I haven&rsquo;t read up enough to know if this requires some more setup.</p>

<p>I had an <code>xscreensaver</code> lock alias earlier, and I wanted something similar; I assigned <code>klock</code> to <code>/usr/lib/kde4/libexec/kscreenlocker --forcelock</code></p>

<p>Finally, I need a way to setup easy terminal access. I setup <code>Meta+T</code> to run <code>konsole</code>, <code>Meta+R</code> to run <code>krunner</code> (which brings up a &ldquo;quick run&rdquo; box), and (I love this part) installed <code>yakuake</code> which I mapped to <code>Meta+`</code>.</p>

<h2>Other switches considered: Firefox</h2>

<p>I tried moving to Firefox for a while, but I really found it slower than Google Chrome. OK, I didn&rsquo;t personally benchmark it, but several content-heavy websites seemed to load slower.</p>

<p>Also, I had gotten used to certain workflows in Chrome (such as entering <code>amazon.com</code>, hitting <code>Tab</code> and then typing what I wanted to search within Amazon) which were no longer possible with Firefox, and I didn&rsquo;t want to take the productivity hit.</p>

<p>However, I installed the Android app, and activated Firefox Sync and everything worked pretty well. Honestly, I liked the mobile app better. But this is one of those all or nothing switches, since the &ldquo;tab syncing&rdquo; between desktop/laptop/mobile browsers is indispensable to me.</p>

<p>I will definitely consider this in the future again, especially if Firefox&rsquo;s rendering speed improves w.r.t. Chrome.</p>

<h2>Other switches considered: Emacs</h2>

<p>This is one of those eternal conflicts, as I mentioned in <a href="/blog/2013/08/06/slimv/">a previous post</a>. I keep wanting to switch to Emacs, but Vim always remains atleast an order of magnitude faster for me, for most common tasks, so I just can&rsquo;t do it.</p>

<p>As I see it, nothing which begins with <code>C-u</code> can ever be faster than the equivalent two-character command in Vim (in particular, <code>C-x z</code> is 10 times slower than just <code>.</code>).</p>

<p>Recently, I was discussing this with a few colleagues, and one of the things that was suggested was <code>Viper</code>-mode in Emacs as a halfway compromise.</p>

<p>I&rsquo;ll look into it, see what keystrokes are supported, and if my regular workflow is unaffected, this too might be a switch I&rsquo;d be willing to make in the future.</p>

<p><em><strong>Update</strong></em>: I have since switched from the linux laptop I was doing this on,
to a Chromebook, making the discussion somewhat moot now. However, I am still
using KDE on a desktop environment and loving it.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-08-14T00:00:00+00:00" pubdate data-updated="true">Aug 14<sup>th</sup>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/desktop/'>desktop</a>, <a class='category' href='/blog/categories/kde/'>kde</a>, <a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/xmonad/'>xmonad</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/08/06/slimv/">
		
			SlimV and Vim (as an Equivalent to Emacs and Slime)</a>
	</h2>
	<div class="entry-content">
		<p>I&rsquo;ve switched between Emacs and Vim a few times over the last 15-odd years, before finally (?) settling on Vim. I&rsquo;ve come to the realization, as many have before me, that for all the elegant awesomeness of Emacs Lisp,</p>

<blockquote><p>Vim is a better <em>text</em> editor, Emacs is good for everything else</p></blockquote>

<p>Perhaps one day if <a href="http://www.gnu.org/software/guile/">Guile</a> or <a href="https://google-melange.appspot.com/gsoc/proposal/review/google/gsoc2013/shanecelis/1">Emacsey</a> deliver their full promise, I&rsquo;ll happily live inside a REPL forever.</p>

<p>Until then, it&rsquo;s just <em>much, much, much</em> faster to do the equivalent <em>text</em> operations in Vim than in Emacs (yes, I mapped CapsLock to Control; yes, I replaced <code>M-</code> by <code>C-xC-m-</code>).</p>

<p>There were still a few Emacs-only things that haunted me (I outgrew the need to have a <a href="http://emacs-w3m.namazu.org/">web browser</a> or an <a href="http://www.gnu.org/software/emacs/manual/html_mono/erc.html">IRC client</a> in my editor environment, I now use Google Chrome for the former and BitchX/Irssi/Xchat for the latter. I also don&rsquo;t mind reading my <a href="http://gmail.com">email</a> in the browser), such as <a href="http://orgmode.org/"><code>org-mode</code></a>. Fortunately for me, I don&rsquo;t most of its features, and keeping a timestamped diary is something I was able to fix for myself with some shell scripting and vim shortcuts.</p>

<p>Recently, I decided to learn Common Lisp with as much of a newbie attitude as possible. And here I ran into a veritable wall of convention. <em>Of course, didn&rsquo;t I know, that Emacs + Slime is the one true way ?</em>
<em><strong>Update</strong></em>: Uh no, I take back that decision (why? maybe a future post to
answer that question)</p>

<p>I dithered, was flustered and nearly reconsidered.</p>

<p>And then I discovered the awesomeness I was looking for, a replacement for Slime in Vim, <a href="http://www.vim.org/scripts/script.php?script_id=2531">Slimv</a>!</p>

<p><a href="http://kovisoft.bitbucket.org/tutorial.html">Here is a tutorial</a> to get you started, but basically all I had to do was to install the plugin and the rest pretty much <em>just worked</em>.</p>

<p>There are quite a lot of nifty tricks here, but my most frequently used commands are:</p>

<ul>
<li><code>,L</code>: that&rsquo;s a comma followed by L): compile current file</li>
<li><code>,D</code>: compile current form</li>
<li><code>,s</code>: lookup a short summary description of the keyword under the cursor</li>
<li><code>,c</code>: Open Slimv session (splits the window horizontally)</li>
</ul>


<p>I was also new to <code>paredit mode</code>, which is pretty much necessary for making changes to heavily nested parantheses, and it has useful commands there too:</p>

<ul>
<li><code>,W</code>: wrap an extra set of parentheses around the current form</li>
<li><code>,S</code>: it&rsquo;s opposite; remove <em>one</em> set of parentheses from the current form</li>
<li><code>,&lt;</code>, <code>,&gt;</code>: move the parentheses under the cursor one form to the left or right</li>
</ul>


<p>&hellip; and much more. So next time someone tells you how <code>Slime</code> is indispensable and hence Emacs is indispensable, throw <code>Slimv</code> in their face! Kudos to <a href="http://www.vim.org/account/profile.php?user_id=16470">the guy who built it</a>!</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-08-06T00:00:00+00:00" pubdate data-updated="true">Aug 6<sup>th</sup>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/vim/'>vim</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/07/24/rudimentary-command-line-note-taking/">
		
			Rudimentary Note Taking on the Command Line</a>
	</h2>
	<div class="entry-content">
		<p>Everyone has their own pet setup; here&rsquo;s mine. Its just a bunch of text files, shared on Dropbox.</p>

<p>I have a bash alias to make a directory if required, create the file, and open it in Vim.</p>

<p>Within the file, I use markdown for text, and a few additional conventions to make it easier to search through them.</p>

<p>I use one file per date, with the name being something like <code>~/notes/2013/07/24</code>.</p>

<p>The following one-liner in my <code>.bashrc</code> accomplishes this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># Bring up the day&#39;s notes</span>
</span><span class='line'><span class="k">function</span> diary<span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="nv">year</span><span class="o">=</span><span class="sb">`</span>date <span class="s2">&quot;+%Y&quot;</span><span class="sb">`</span>
</span><span class='line'>  <span class="nv">month</span><span class="o">=</span><span class="sb">`</span>date <span class="s2">&quot;+%m&quot;</span><span class="sb">`</span>
</span><span class='line'>  <span class="nv">day</span><span class="o">=</span><span class="sb">`</span>date <span class="s2">&quot;+%d&quot;</span><span class="sb">`</span>
</span><span class='line'>  <span class="nv">diarydir</span><span class="o">=</span>~/Dropbox/personalnotes/<span class="nv">$year</span>/<span class="nv">$month</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">[[</span> ! -d <span class="s2">&quot;$diarydir&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    mkdir -p <span class="s2">&quot;$diarydir&quot;</span>
</span><span class='line'>  <span class="k">fi</span>
</span><span class='line'>  vi <span class="nv">$diarydir</span>/<span class="nv">$day</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I also use some additional <em>metadata</em> within it, such as adding &lsquo;@14:45&rsquo; to indicate a timestamp before a paragraph, and &lsquo;#category&rsquo; to mark off sections (I use &lsquo;##category&rsquo; to denote one-line or one paragraph sections, otherwise all text is assumed to belong to the last declared section).</p>

<p>For convenience, I defined the following mapping in my <code>.vimrc</code> that inserts the timestamp when required:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>nmap &lt;C-c&gt;&lt;C-t&gt; o@&lt;C-R&gt;<span class="o">=</span>strftime<span class="o">(</span><span class="s2">&quot;%H:%M&quot;</span><span class="o">)</span>&lt;CR&gt;&lt;CR&gt;&lt;CR&gt;
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ll cover the retrieval part of this in a separate post. If you don&rsquo;t have any note taking system yet, and don&rsquo;t want to go to the extent of <em>blogging</em> every little thing you want to note down, and find it a bit of a hassle to open up Evernote or something similar to jot something down, you might like to try this quick and simple text-based solution!</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-07-24T00:00:00+00:00" pubdate data-updated="true">Jul 24<sup>th</sup>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/commandline/'>commandline</a>, <a class='category' href='/blog/categories/notes/'>notes</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/06/26/data-structures-haskell-vs-cpp/">
		
			Comparison of Data Structures in C++ and Haskell</a>
	</h2>
	<div class="entry-content">
		<p>Once again, just to satisfy my curiosity, I want to do a tiny comparison of a basic feature in both languages, trying to see how data structures are implemented. Ok, I&rsquo;m fairly certain how it works for in C++, I&rsquo;m really just curious about Haskell.</p>

<h2>C++ version</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'><span class="cp">#include &lt;memory&gt;</span>
</span><span class='line'><span class="cp">#include &lt;vector&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">BinaryNode</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
</span><span class='line'>  <span class="n">BinaryNode</span> <span class="o">*</span><span class="n">leftchild</span><span class="p">,</span> <span class="o">*</span><span class="n">rightchild</span><span class="p">;</span>
</span><span class='line'>  <span class="n">BinaryNode</span><span class="p">(</span><span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="n">BinaryNode</span><span class="o">*</span> <span class="n">lc</span> <span class="o">=</span> <span class="n">nullptr</span><span class="p">,</span> <span class="n">BinaryNode</span><span class="o">*</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">nullptr</span><span class="p">)</span>
</span><span class='line'>    <span class="o">:</span> <span class="n">val</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">leftchild</span><span class="p">(</span><span class="n">lc</span><span class="p">),</span> <span class="n">rightchild</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span> <span class="p">{}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">NaryNode</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">NaryNode</span><span class="o">*&gt;</span> <span class="n">children</span><span class="p">;</span>
</span><span class='line'>  <span class="n">NaryNode</span><span class="p">(</span><span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">NaryNode</span><span class="o">*&gt;&amp;</span> <span class="n">c</span><span class="p">)</span> <span class="o">:</span> <span class="n">val</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">children</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">binarySum</span><span class="p">(</span><span class="n">BinaryNode</span><span class="o">*</span> <span class="n">node</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">node</span> <span class="o">==</span> <span class="n">nullptr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">+</span> <span class="n">binarySum</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">leftchild</span><span class="p">)</span> <span class="o">+</span> <span class="n">binarySum</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">rightchild</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">narySum</span><span class="p">(</span><span class="n">NaryNode</span><span class="o">*</span> <span class="n">node</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">node</span> <span class="o">==</span> <span class="n">nullptr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">;</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="nl">it</span> <span class="p">:</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">sum</span> <span class="o">+=</span> <span class="n">narySum</span><span class="p">(</span><span class="n">it</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">sum</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Create dummy binary and n-ary trees and print out their sum</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">BinaryNode</span><span class="o">&gt;</span> <span class="n">bnode1</span><span class="p">(</span><span class="n">new</span> <span class="n">BinaryNode</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">BinaryNode</span><span class="o">&gt;</span> <span class="n">bnode2</span><span class="p">(</span><span class="n">new</span> <span class="n">BinaryNode</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">BinaryNode</span><span class="o">&gt;</span> <span class="n">broot</span><span class="p">(</span><span class="n">new</span> <span class="n">BinaryNode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bnode1</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">bnode2</span><span class="p">.</span><span class="n">get</span><span class="p">()));</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;BinarySum = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">binarySum</span><span class="p">(</span><span class="n">broot</span><span class="p">.</span><span class="n">get</span><span class="p">())</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">NaryNode</span><span class="o">*&gt;</span> <span class="n">children</span><span class="p">;</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">NaryNode</span><span class="o">&gt;</span> <span class="n">nnode1</span><span class="p">(</span><span class="n">new</span> <span class="n">NaryNode</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">children</span><span class="p">));</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">NaryNode</span><span class="o">&gt;</span> <span class="n">nnode2</span><span class="p">(</span><span class="n">new</span> <span class="n">NaryNode</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">children</span><span class="p">));</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">NaryNode</span><span class="o">&gt;</span> <span class="n">nnode3</span><span class="p">(</span><span class="n">new</span> <span class="n">NaryNode</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">children</span><span class="p">));</span>
</span><span class='line'>  <span class="n">children</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">nnode1</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
</span><span class='line'>  <span class="n">children</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">nnode2</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
</span><span class='line'>  <span class="n">children</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">nnode3</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">NaryNode</span><span class="o">&gt;</span> <span class="n">nroot</span><span class="p">(</span><span class="n">new</span> <span class="n">NaryNode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">children</span><span class="p">));</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;NarySum = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">narySum</span><span class="p">(</span><span class="n">nroot</span><span class="p">.</span><span class="n">get</span><span class="p">())</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Assembly highlights:</p>

<p>Uploaded the full file as a <a href="https://gist.github.com/agam/5872178">Gist</a> (it&rsquo;s 6437 lines long, we aren&rsquo;t in <em>Hello World</em> territory any more; on the other hand, this program would have been much longer in C.</p>

<p>The function <code>_Z9binarySumP10BinaryNode</code> is defined near the top, and the function <code>_Z7narySumP8NaryNode</code> right under it.</p>

<p>The assembly code follows along almost exactly as the C++ code above (of course all the struct offsets are &ldquo;just added&rdquo; and you don&rsquo;t see the members being accessed directly).</p>

<p>The recursion is more obviously visible for the first function, where you see a pattern of &ldquo;call the function&rdquo;, &ldquo;call the function again&rdquo; and then add the node value to it. For the second function, you can see calls to <code>vector&lt;NaryNode&gt;::begin()</code> and <code>vector&lt;NaryNode&gt;::end()</code> at the beginning of the loop, and the test &lsquo;n&rsquo; jump and the recursive call in the middle of the body.</p>

<p>It is useful also to see how <code>main()</code> works here, you can see three calls to the <code>BinaryNode</code> constructor (<code>_ZN10BinaryNodeC1EiPS_S0_</code>), and then similar stuff for the <code>NaryNode</code> objects. At the end are multiple calls to the destructors (similar to <code>callq _ZNSt10unique_ptrI8NaryNodeSt14default_deleteIS0_EED1Ev</code>).</p>

<p>Most of the rest of the code is the definition of these functions (vector begin/end and unique_ptr delete etc.)</p>

<p>Note: I found a better way to show the assembly &lt;&ndash;> source correspondence, in an interactive way: <a href="http://gcc.godbolt.org/">GCC Explorer</a> and I&rsquo;ll use that next time, it&rsquo;s just way more convenient. Also, I&rsquo;ve been showing unoptimized assembly, which is <em>just noise</em>, will refer to <code>-O2</code> next time.</p>

<h2>Haskell version</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kr">data</span> <span class="kt">BinaryTree</span> <span class="n">a</span> <span class="ow">=</span> <span class="kt">BinaryLeaf</span> <span class="n">a</span> <span class="o">|</span> <span class="kt">BinaryBranch</span> <span class="p">(</span><span class="kt">BinaryTree</span> <span class="n">a</span><span class="p">)</span> <span class="p">(</span><span class="kt">BinaryTree</span> <span class="n">a</span><span class="p">)</span>
</span><span class='line'><span class="kr">data</span> <span class="kt">NaryTree</span> <span class="n">a</span> <span class="ow">=</span> <span class="kt">NaryLeaf</span> <span class="n">a</span> <span class="o">|</span> <span class="kt">NaryBranch</span> <span class="p">[</span><span class="kt">NaryTree</span> <span class="n">a</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="nf">binarySum</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Num</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="kt">BinaryTree</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span>
</span><span class='line'><span class="nf">binarySum</span> <span class="p">(</span><span class="kt">BinaryLeaf</span> <span class="n">x</span><span class="p">)</span> <span class="ow">=</span> <span class="n">x</span>
</span><span class='line'><span class="nf">binarySum</span> <span class="p">(</span><span class="kt">BinaryBranch</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=</span>  <span class="p">(</span><span class="n">binarySum</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">binarySum</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nf">narySum</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Num</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">NaryTree</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span>
</span><span class='line'><span class="nf">narySum</span> <span class="p">(</span><span class="kt">NaryLeaf</span> <span class="n">x</span><span class="p">)</span> <span class="ow">=</span> <span class="n">x</span>
</span><span class='line'><span class="nf">narySum</span> <span class="p">(</span><span class="kt">NaryBranch</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=</span> <span class="n">foldl</span> <span class="p">(</span><span class="nf">\</span><span class="n">acc</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">acc</span> <span class="o">+</span> <span class="p">(</span><span class="n">narySum</span> <span class="n">x</span><span class="p">))</span> <span class="mi">0</span> <span class="n">b</span>
</span><span class='line'>
</span><span class='line'><span class="c1">--Create dummy binary and n-ary trees and print out their sum</span>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="kr">let</span> <span class="n">bt</span> <span class="ow">=</span> <span class="kt">BinaryBranch</span> <span class="p">(</span><span class="kt">BinaryLeaf</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="kt">BinaryLeaf</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>           <span class="n">nt</span> <span class="ow">=</span> <span class="kt">NaryBranch</span> <span class="p">((</span><span class="kt">NaryLeaf</span> <span class="mi">4</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kt">NaryLeaf</span> <span class="mi">5</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kt">NaryLeaf</span> <span class="mi">6</span><span class="p">)</span> <span class="kt">:</span> <span class="kt">[]</span><span class="p">)</span>
</span><span class='line'>       <span class="kr">in</span> <span class="kr">do</span>
</span><span class='line'>          <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;BinarySum = &quot;</span> <span class="o">++</span> <span class="n">show</span><span class="p">(</span><span class="n">binarySum</span> <span class="n">bt</span><span class="p">))</span>
</span><span class='line'>          <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;NarySum = &quot;</span> <span class="o">++</span> <span class="n">show</span><span class="p">(</span><span class="n">narySum</span> <span class="n">nt</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Assembly highlights:</p>

<p>Uploaded the <a href="https://gist.github.com/agam/5974455">full file (core) as a Gist</a></p>

<p><code>main</code> is present as <code>main1</code> near the bottom, which has two calls to <code>Handle.Text.hPutStr2</code></p>

<p>The binary sum is unpacked quite straightforwardly :&ndash;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="nf">main_</span><span class="o">$</span><span class="n">sbinarySum</span> <span class="ow">=</span>
</span><span class='line'>  <span class="nf">\</span> <span class="p">(</span><span class="n">ds_dBk</span> <span class="ow">::</span> <span class="kt">BinaryTree</span> <span class="kt">Type</span><span class="o">.</span><span class="kt">Integer</span><span class="p">)</span> <span class="ow">-&gt;</span>
</span><span class='line'>    <span class="kr">case</span> <span class="n">ds_dBk</span> <span class="kr">of</span> <span class="kr">_</span> <span class="p">{</span>
</span><span class='line'>      <span class="kt">BinaryLeaf</span> <span class="n">x_aaA</span> <span class="ow">-&gt;</span> <span class="n">x_aaA</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">BinaryBranch</span> <span class="n">a_aaB</span> <span class="n">b_aaC</span> <span class="ow">-&gt;</span>
</span><span class='line'>        <span class="kt">Type</span><span class="o">.</span><span class="n">plusInteger</span>
</span><span class='line'>          <span class="p">(</span><span class="n">main_</span><span class="o">$</span><span class="n">sbinarySum</span> <span class="n">a_aaB</span><span class="p">)</span> <span class="p">(</span><span class="n">main_</span><span class="o">$</span><span class="n">sbinarySum</span> <span class="n">b_aaC</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>whereas the nary sum is less so :&ndash;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="nf">main_</span><span class="o">$</span><span class="n">snarySum</span> <span class="ow">=</span>
</span><span class='line'>  <span class="nf">\</span> <span class="p">(</span><span class="n">ds_dtA</span> <span class="ow">::</span> <span class="kt">NaryTree</span> <span class="kt">Type</span><span class="o">.</span><span class="kt">Integer</span><span class="p">)</span> <span class="ow">-&gt;</span>
</span><span class='line'>    <span class="kr">case</span> <span class="n">ds_dtA</span> <span class="kr">of</span> <span class="kr">_</span> <span class="p">{</span>
</span><span class='line'>      <span class="kt">NaryLeaf</span> <span class="n">x_aad</span> <span class="ow">-&gt;</span> <span class="n">x_aad</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">NaryBranch</span> <span class="n">b_aae</span> <span class="ow">-&gt;</span> <span class="n">lgo_r1MR</span> <span class="n">lvl_r1MQ</span> <span class="n">b_aae</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nf">lgo_r1MR</span> <span class="ow">=</span>
</span><span class='line'>  <span class="nf">\</span> <span class="p">(</span><span class="n">z_atM</span> <span class="ow">::</span> <span class="kt">Type</span><span class="o">.</span><span class="kt">Integer</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="n">ds_atN</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">NaryTree</span> <span class="kt">Type</span><span class="o">.</span><span class="kt">Integer</span><span class="p">])</span> <span class="ow">-&gt;</span>
</span><span class='line'>    <span class="kr">case</span> <span class="n">ds_atN</span> <span class="kr">of</span> <span class="kr">_</span> <span class="p">{</span>
</span><span class='line'>      <span class="kt">[]</span> <span class="ow">-&gt;</span> <span class="n">z_atM</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">:</span> <span class="n">x_atS</span> <span class="n">xs_atT</span> <span class="ow">-&gt;</span>
</span><span class='line'>        <span class="n">lgo_r1MR</span>
</span><span class='line'>          <span class="p">(</span><span class="kt">Type</span><span class="o">.</span><span class="n">plusInteger</span> <span class="n">z_atM</span> <span class="p">(</span><span class="n">main_</span><span class="o">$</span><span class="n">snarySum</span> <span class="n">x_atS</span><span class="p">))</span>
</span><span class='line'>          <span class="n">xs_atT</span>
</span><span class='line'>    <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>with the second function being defined for iteration. I uploaded a gist with the <a href="https://gist.github.com/agam/5974501">assembly output</a>, which is of course tedious and quite spaghetti-like.</p>

<p>Here is an example of the nary leaf:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">.globl</span> <span class="nv">Main_NaryLeaf_closure</span>
</span><span class='line'><span class="nf">.type</span> <span class="nv">Main_NaryLeaf_closure</span><span class="p">,</span> <span class="err">@</span><span class="nv">object</span>
</span><span class='line'><span class="nl">Main_NaryLeaf_closure:</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="nv">Main_NaryLeaf_info</span>
</span><span class='line'><span class="nf">.text</span>
</span><span class='line'>  <span class="nf">.align</span> <span class="mi">8</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="mi">4294967301</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="mi">0</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="mi">15</span>
</span><span class='line'><span class="nl">Main_NaryLeaf_info:</span>
</span><span class='line'><span class="nl">.LcBb:</span>
</span><span class='line'>  <span class="nf">addq</span> <span class="kc">$</span><span class="mi">16</span><span class="p">,</span><span class="o">%</span><span class="nv">r12</span>
</span><span class='line'>  <span class="nf">cmpq</span> <span class="mi">144</span><span class="p">(</span><span class="o">%</span><span class="nv">r13</span><span class="p">),</span><span class="o">%</span><span class="nv">r12</span>
</span><span class='line'>  <span class="nf">ja</span> <span class="nv">.LcBg</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="kc">$</span><span class="nv">Main_NaryLeaf_con_info</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="o">%</span><span class="nv">r14</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">leaq</span> <span class="o">-</span><span class="mi">7</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">),</span><span class="o">%</span><span class="nb">rbx</span>
</span><span class='line'>  <span class="nf">jmp</span> <span class="o">*</span><span class="mi">0</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">)</span>
</span><span class='line'><span class="nl">.LcBg:</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="kc">$</span><span class="mi">16</span><span class="p">,</span><span class="mi">192</span><span class="p">(</span><span class="o">%</span><span class="nv">r13</span><span class="p">)</span>
</span><span class='line'><span class="nl">.LcBe:</span>
</span><span class='line'>  <span class="nf">movl</span> <span class="kc">$</span><span class="nv">Main_NaryLeaf_closure</span><span class="p">,</span><span class="o">%</span><span class="nb">ebx</span>
</span><span class='line'>  <span class="nf">jmp</span> <span class="o">*-</span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="nv">r13</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">.size</span> <span class="nv">Main_NaryLeaf_info</span><span class="p">,</span> <span class="nv">.</span><span class="o">-</span><span class="nv">Main_NaryLeaf_info</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Running time</h2>

<p>Pretty much on par here:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">time</span> ./cpptree
</span><span class='line'><span class="nv">BinarySum</span> <span class="o">=</span> 9
</span><span class='line'><span class="nv">NarySum</span> <span class="o">=</span> 15
</span><span class='line'>
</span><span class='line'>real  0m0.005s
</span><span class='line'>user  0m0.000s
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span><span class="nb">time</span> ./haskelltree
</span><span class='line'><span class="nv">BinarySum</span> <span class="o">=</span> 9
</span><span class='line'><span class="nv">NarySum</span> <span class="o">=</span> 15
</span><span class='line'>
</span><span class='line'>real  0m0.004s
</span><span class='line'>user  0m0.000s
</span><span class='line'>sys   0m0.000s
</span></code></pre></td></tr></table></div></figure>


<p>Fast compilation, comparable run-time, shorter code &hellip; we&rsquo;re talking serious competition here :)</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-06-26T00:00:00+00:00" pubdate data-updated="true">Jun 26<sup>th</sup>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/c-plus-plus/'>c++</a>, <a class='category' href='/blog/categories/haskell/'>haskell</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/06/23/clang-vs-gcc-which-would-you-use/">
		
			Clang vs Gcc, Which Would You Use?</a>
	</h2>
	<div class="entry-content">
		<p>Compare these two runs &hellip;</p>

<h2>Clang Error</h2>

<p><img src="/images/clang-error.png" alt="Clang Error highlights source text and is color-coded and formatted to show the location of the actual error, along with actionable suggestions" /></p>

<h2>G++ Error</h2>

<p><img src="/images/gcc-error.png" alt="G++ Error is not color-coded, not formatted, and the actual error is obscured with language lawyer suggestions" /></p>

<p>&hellip; <em>Enough said, hopefully.</em></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-06-23T00:00:00+00:00" pubdate data-updated="true">Jun 23<sup>rd</sup>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/clang/'>clang</a>, <a class='category' href='/blog/categories/compiler/'>compiler</a>, <a class='category' href='/blog/categories/gcc/'>gcc</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/06/22/python-to-go/">
		
			Appengine Transition From Python to Go</a>
	</h2>
	<div class="entry-content">
		<p>Hadn&rsquo;t updated this blog for a few months, and neither the &ldquo;personal web site&rdquo; that I had started earlier. So, to try something new, I decided to port that appengine site from python to go (looking at the Github logs, I haven&rsquo;t updated that for 2 years !!)</p>

<p>The <code>app.yaml</code> is changed to get rid of all non-static handlers (which are now declared inside the <code>func init()</code> in the <code>.go</code> file. So the only handlers will be <code>/static</code>, <code>/robots.txt</code>, and <code>/.*</code>.</p>

<p>Both the <a href="https://developers.google.com/appengine/docs/go/">Appengine docs</a> as well as <a href="http://cuddle.googlecode.com/hg/talk/index.html">a couple</a> <a href="http://jan.newmarch.name/go/chinese/chapter-chinese.html">of examples</a> have basic bootstrapping information.</p>

<p>The first thing I did was to make a barebones &ldquo;Hello World&rdquo; index handler, and run it with</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>google_appengine/dev_appserver.py &lt;path to my app&gt;
</span></code></pre></td></tr></table></div></figure>


<p>But I immediately got this error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>google.appengine.tools.devappserver2.wsgi_server.BindError: Unable to find a consistent port localhost
</span><span class='line'>Exception in thread Thread-4 <span class="o">(</span>most likely raised during interpreter shutdown<span class="o">)</span>:
</span><span class='line'>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class='line'>  File <span class="s2">&quot;/usr/lib/python2.7/threading.py&quot;</span>, line 551, in __bootstrap_inner
</span><span class='line'>  File <span class="s2">&quot;/usr/lib/python2.7/threading.py&quot;</span>, line 504, in run
</span><span class='line'>  File <span class="s2">&quot;/home/agam/Documents/Code/google_appengine/google/appengine/api/taskqueue/taskqueue_stub.py&quot;</span>, line 2014, in MainLoop
</span><span class='line'>  File <span class="s2">&quot;/home/agam/Documents/Code/google_appengine/google/appengine/api/taskqueue/taskqueue_stub.py&quot;</span>, line 2006, in _Wait
</span><span class='line'>  File <span class="s2">&quot;/usr/lib/python2.7/threading.py&quot;</span>, line 403, in <span class="nb">wait</span>
</span><span class='line'><span class="nb">  </span>File <span class="s2">&quot;/usr/lib/python2.7/threading.py&quot;</span>, line 258, in <span class="nb">wait</span>
</span><span class='line'>&lt;<span class="nb">type</span> <span class="s1">&#39;exceptions.TypeError&#39;</span>&gt;: <span class="s1">&#39;NoneType&#39;</span> object is not callable
</span></code></pre></td></tr></table></div></figure>


<p>After some Googling and Stackoverflowing, I found a somewhat bizarre fix (to use <code>--api_port</code> argument) with the root cause identified as being duplicate <code>localhost</code> mappings in the <code>/etc/hosts</code> file, including ipv6 mappings to localhost. Now I don&rsquo;t want to mess up my <code>/etc/hosts</code> with what is certainly a <em>bad idea</em>, so I used the <code>--api_port</code> option and I saw the &lsquo;hello world&rsquo;. So far, so good.</p>

<p>I had terrible fonts from long ago, and since Google Web Fonts has become pretty awesome since then, headed on over to pick a few custom fonts. Also realized that I really just need to keep the index page, since the custom blog that I started is really superseded by this one and the posterous feed tracker was obsolete some time ago.</p>

<p>The handler idea is quite straightforward, and there is definitely less boilerplate than what <code>index.py</code> was using earlier.</p>

<p>Initial stupid error: All requests were going to the same handler (including static css ones). Had to change url order in <code>app.yaml</code> to move the <code>/static</code> above the <code>/.*</code>.</p>

<p>Ok, all set, the barebones appengine site is up and running, I hope I can add some fun stuff to this in the future!</p>

<p><em>Update</em>:
We aren&rsquo;t done yet; after I uploaded the app (<code>appcfg.py update</code>, which by the way prefers <code>--oauth2</code> but won&rsquo;t tell you about it) the html wasn&rsquo;t being served.
I added a <code>log.Fatal()</code> and sure enough the file wasn&rsquo;t being read any more.</p>

<p>This was also a good time to see error handling in place, the application logs showed</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>panic: os.Exit called
</span><span class='line'>runtime.panic go/src/pkg/runtime/panic.c:230
</span><span class='line'>os.Exit go/src/pkg/os/proc.go:42
</span><span class='line'>log.Fatal go/src/pkg/log/log.go:289
</span><span class='line'>agamsweb.indexHandler agamsweb/agamsweb.go:18
</span><span class='line'>net/http.HandlerFunc.ServeHTTP go/src/pkg/net/http/server.go:1150
</span><span class='line'>net/http.<span class="o">(</span>*ServeMux<span class="o">)</span>.ServeHTTP go/src/pkg/net/http/server.go:1417
</span><span class='line'>appengine_internal.executeRequestSafely go/src/pkg/appengine_internal/api_prod.go:248
</span><span class='line'>appengine_internal.<span class="o">(</span>*server<span class="o">)</span>.HandleRequest go/src/pkg/appengine_internal/api_prod.go:198
</span><span class='line'>reflect.Value.call go/src/pkg/reflect/value.go:474
</span><span class='line'>reflect.Value.Call go/src/pkg/reflect/value.go:345
</span><span class='line'>_ _.go:316
</span><span class='line'>runtime.goexit go/src/pkg/runtime/proc.c:280
</span></code></pre></td></tr></table></div></figure>


<p>While testing this I also ran into an appengine bug: it is possible to get the following error message, though it literally doesn&rsquo;t make much sense</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>E 2013-06-23 11:53:32.539
</span><span class='line'>Request failed because the app binary was missing. This can generally be fixed by redeploying your app.
</span><span class='line'>I 2013-06-23 11:53:32.539
</span><span class='line'>This request caused a new process to be started <span class="k">for</span> your application, and thus caused your application code to be loaded <span class="k">for</span> the first time.
</span><span class='line'>This request may thus take longer and use more CPU than a typical request <span class="k">for</span> your application.
</span></code></pre></td></tr></table></div></figure>


<p>(i..e how can the app binary be missing <em>after</em> the application was loaded? :) )</p>

<p>After much digging, realized that it isn&rsquo;t possible to read files specified by the <code>static</code> handler.</p>

<p>Hmm so I don&rsquo;t really need any go code to do anything meaningful right now, I&rsquo;ll leave &lsquo;hello world&rsquo; running :/</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-06-22T00:00:00+00:00" pubdate data-updated="true">Jun 22<sup>nd</sup>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/appengine/'>appengine</a>, <a class='category' href='/blog/categories/go/'>go</a>, <a class='category' href='/blog/categories/python/'>python</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/03/20/hakyll-broken/">
		
			Hakyll Broken ?</a>
	</h2>
	<div class="entry-content">
		<p>I noticed that the dates in my blog were all wrong, and now the blog
doesn&rsquo;t build.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ghc --make blog.hs
</span><span class='line'><span class="o">[</span><span class="m">1</span> of 1<span class="o">]</span> Compiling Main             <span class="o">(</span> blog.hs, blog.o <span class="o">)</span>
</span><span class='line'>
</span><span class='line'>blog.hs:27:12:
</span><span class='line'>    Not in scope: <span class="sb">`</span>list<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">    Perhaps you meant `last&#39;</span> <span class="o">(</span>imported from Prelude<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>blog.hs:29:21: Not in scope: <span class="sb">`</span>pageCompiler<span class="s1">&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="s1">blog.hs:30:17: Not in scope: `applyTemplateCompiler&#39;</span>
</span><span class='line'>
</span><span class='line'>blog.hs:31:17: Not in scope: <span class="sb">`</span>relativizeUrlsCompiler<span class="s1">&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="s1">blog.hs:34:27:</span>
</span><span class='line'><span class="s1">    Not in scope: `constA&#39;</span>
</span><span class='line'>    Perhaps you meant <span class="sb">`</span>const<span class="s1">&#39; (imported from Prelude)</span>
</span><span class='line'>
</span><span class='line'><span class="s1">blog.hs:35:18: Not in scope: `setField&#39;</span>
</span><span class='line'>
</span><span class='line'>blog.hs:36:13: Not in scope: <span class="sb">`</span>requireAllA<span class="s1">&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="s1">blog.hs:37:13: Not in scope: `applyTemplateCompiler&#39;</span>
</span><span class='line'>
</span><span class='line'>blog.hs:38:13: Not in scope: <span class="sb">`</span>applyTemplateCompiler<span class="s1">&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="s1">blog.hs:39:13: Not in scope: `relativizeUrlsCompiler&#39;</span>
</span><span class='line'>
</span><span class='line'>blog.hs:43:21: Not in scope: <span class="sb">`</span>pageCompiler<span class="s1">&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="s1">blog.hs:44:17: Not in scope: `applyTemplateCompiler&#39;</span>
</span><span class='line'>
</span><span class='line'>blog.hs:45:17: Not in scope: <span class="sb">`</span>applyTemplateCompiler<span class="s1">&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="s1">blog.hs:46:17: Not in scope: `relativizeUrlsCompiler&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The price to pay for using a system in flux &hellip; oh well, time to read up on
the <a href="http://jaspervdj.be/hakyll/tutorials/04-compilers.html">hakyll
transition</a> from v3 to v4.</p>

<p>Alright, that isn&rsquo;t good enough &hellip; need some &lsquo;patterns&rsquo; to work with.
Luckily, I found <a href="http://wmasson.com/">another Hakyll blog</a> that made the jump, and shameless
plagiarized. (So thank you, <code>wmasson</code>!)</p>

<p>Well, I didn&rsquo;t even plagiarize well. I used tabs instead of spaces at one
point and stared at a <code>parse error on input `='</code> error message for
<em>some time</em>.</p>

<p>I spent some more time staring at</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>blog.hs:39:47:
</span><span class='line'>    Couldn<span class="s1">&#39;t match expected type `Item String&#39;</span>
</span><span class='line'>                with actual <span class="nb">type</span> <span class="sb">`</span><span class="o">[</span>Item String<span class="o">]</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">    Expected type: [Item String] -&gt; [Item String]</span>
</span><span class='line'><span class="s1">      Actual type: [Item String] -&gt; [[Item String]]</span>
</span><span class='line'><span class="s1">    In the second argument of `(.)&#39;</span>, namely <span class="sb">`</span>recentFirst<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">    In the second argument of `($)&#39;</span>, namely <span class="sb">`</span>take <span class="m">3</span> . recentFirst<span class="err">&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip; and then I realized that the signature of <code>postList</code> was wrong and should have its second argument as <code>([Item String] -&gt; Compiler [Item String])</code> instead of <code>([Item String] -&gt; [Item String])</code>.
Had to change <code>prep &lt;$&gt; loadAll pattern</code> to <code>prep =&lt;&lt; loadAll pattern</code> to accomodate this change.</p>

<p>Somehow the type signature of the main page function didn&rsquo;t match, so I modified the <code>postList</code> function to take a <code>listmodifier</code>; this way I could pass in <code>id</code> for the list of all posts and <code>(take 3)</code> for the main page.</p>

<p>I also had to change the date format from <code>%d %m %Y</code> to <code>%Y-%m-%d</code>, since I was getting an</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>ERROR<span class="o">]</span> Hakyll.Web.Template.Context.getItemUTC: could not parse <span class="nb">time </span><span class="k">for</span> ...
</span></code></pre></td></tr></table></div></figure>


<p>error message, looking at the <a href="https://github.com/jaspervdj/hakyll/blob/master/src/Hakyll/Web/Template/Context.hs#L200">source</a> I found that only a few formats were supported.</p>

<p>Finally, right at the end, I clobbered the git submodule in my output directory when I did a <code>./blog rebuild</code>. So to bring it back, I had to</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>rm -f .gitmodules
</span><span class='line'><span class="nv">$ </span>./blog clean
</span><span class='line'>Removing _site...
</span><span class='line'>Removing _cache...
</span><span class='line'>Removing _cache/tmp...
</span><span class='line'><span class="nv">$ </span>git rm -r _site
</span><span class='line'>rm <span class="s1">&#39;_site&#39;</span>
</span><span class='line'><span class="nv">$ </span>git submodule add --force git@github.com:agam/agam.github.com.git _site
</span><span class='line'>Reactivating <span class="nb">local </span>git directory <span class="k">for</span> submodule <span class="s1">&#39;_site&#39;</span>.
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>_site
</span><span class='line'><span class="nv">$ </span>git checkout master
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ..
</span><span class='line'><span class="nv">$ </span>./blog build
</span></code></pre></td></tr></table></div></figure>


<p>So &hellip; no outward change in appearance, but a lot of time wasted, and all because I was bold enough to run <code>cabal update</code>.</p>

<p>Yes, I know. Sad.</p>

<p>But it works! (atleast the chronological sorting works again).</p>

<p><em><strong>Update:</strong></em> <a href="https://github.com/agam/hakyll-source/commit/9af1c492dc34e2ffb677a619ac86113a8a716703">This diff</a> might help to show the changes required.
<em><strong>Update:</strong></em> Just for fun, I tweaked the CSS of the page a bit, to make it a little less bland.</p>

<p><em>Update</em>: I have sinced moved to <a href="http://jekyllrb.com/">Jekyll</a>, so if Hakyll
has moved on to a different version, this blog post should be considered
obsolete.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-03-20T00:00:00+00:00" pubdate data-updated="true">Mar 20<sup>th</sup>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/hakyll/'>hakyll</a>, <a class='category' href='/blog/categories/haskell/'>haskell</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/03/13/basic-iteration-comparison/">
		
			Comparing Basic Iteration in C++ and Haskell: Part 1</a>
	</h2>
	<div class="entry-content">
		<h2><code>For loop</code> iteration: C</h2>

<p>First, basic iteration over an array.</p>

<p>C++ Source :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'><span class="cp">#include &lt;vector&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span> <span class="p">{</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">34</span> <span class="p">,</span><span class="mi">45</span> <span class="p">,</span><span class="mi">56</span> <span class="p">,</span><span class="mi">67</span> <span class="p">,</span><span class="mi">78</span><span class="p">,</span> <span class="mi">89</span> <span class="p">};</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">i</span> <span class="p">:</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Compile/Assemble:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>g++ -std<span class="o">=</span>c++0x -S -o simpleloopcpp simpleloop.cpp
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ve stored the result in <a href="https://gist.github.com/agam/5194257">this
gist</a>. As you can see, this is
<em>enormous</em> !! And all because we introduced <code>STL</code> into the picture !!!</p>

<p>So I obviously won&rsquo;t include all 1742 lines here, but let&rsquo;s see if we can
scan some high level features and go a bit deeper into the parts of the
code we&rsquo;ll compare with the haskell version of this.</p>

<p>(Skipping some boiler plate and the initializer list creater )</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">.text</span>
</span><span class='line'><span class="nf">.globl</span>    <span class="nv">main</span>
</span><span class='line'><span class="nf">.type</span> <span class="nv">main</span><span class="p">,</span> <span class="err">@</span><span class="nv">function</span>
</span><span class='line'><span class="nl">main:</span>
</span><span class='line'><span class="nl">.LFB1490:</span>
</span><span class='line'><span class="nf">.cfi_startproc</span>
</span><span class='line'><span class="nf">.cfi_personality</span> <span class="mh">0x3</span><span class="p">,</span><span class="nv">__gxx_personality_v0</span>
</span><span class='line'><span class="nf">.cfi_lsda</span> <span class="mh">0x3</span><span class="p">,</span><span class="nv">.LLSDA1490</span>
</span><span class='line'><span class="nf">pushq</span> <span class="o">%</span><span class="nb">rbp</span>
</span><span class='line'><span class="nf">.cfi_def_cfa_offset</span> <span class="mi">16</span>
</span><span class='line'><span class="nf">.cfi_offset</span> <span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">16</span>
</span><span class='line'><span class="nf">movq</span>  <span class="o">%</span><span class="nb">rsp</span><span class="p">,</span> <span class="o">%</span><span class="nb">rbp</span>
</span><span class='line'><span class="nf">.cfi_def_cfa_register</span> <span class="mi">6</span>
</span><span class='line'><span class="nf">pushq</span> <span class="o">%</span><span class="nb">rbx</span>
</span><span class='line'><span class="nf">subq</span>  <span class="kc">$</span><span class="mi">120</span><span class="p">,</span> <span class="o">%</span><span class="nb">rsp</span>
</span><span class='line'><span class="nf">movl</span>  <span class="o">%</span><span class="nb">edi</span><span class="p">,</span> <span class="o">-</span><span class="mi">116</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">)</span>
</span><span class='line'><span class="nf">movq</span>  <span class="o">%</span><span class="nb">rsi</span><span class="p">,</span> <span class="o">-</span><span class="mi">128</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">)</span>
</span><span class='line'><span class="nf">leaq</span>  <span class="o">-</span><span class="mi">17</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">rax</span>
</span><span class='line'><span class="nf">movq</span>  <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>
</span><span class='line'><span class="nf">.cfi_offset</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">24</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here is the
<a href="http://en.cppreference.com/w/cpp/utility/initializer_list"><code>std::initializer_list</code></a> being initialized</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">call</span> <span class="nv">_ZNSaIiEC1Ev</span>
</span><span class='line'><span class="nf">leaq</span>  <span class="o">-</span><span class="mi">80</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">rax</span>
</span><span class='line'><span class="nf">movl</span>  <span class="kc">$</span><span class="mi">8</span><span class="p">,</span> <span class="o">%</span><span class="nb">edx</span>
</span><span class='line'><span class="nf">movl</span>  <span class="kc">$</span><span class="nv">._89</span><span class="p">,</span> <span class="o">%</span><span class="nb">esi</span>
</span><span class='line'><span class="nf">movq</span>  <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>
</span><span class='line'><span class="nf">call</span>  <span class="nv">_ZNSt16initializer_listIiEC1EPKim</span>
</span></code></pre></td></tr></table></div></figure>


<p>(It is declared elsewhere)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">.size</span>    <span class="nv">._89</span><span class="p">,</span> <span class="mi">32</span>
</span><span class='line'><span class="nl">._89:</span>
</span><span class='line'><span class="nf">.long</span> <span class="mi">12</span>
</span><span class='line'><span class="nf">.long</span> <span class="mi">23</span>
</span><span class='line'><span class="nf">.long</span> <span class="mi">34</span>
</span><span class='line'><span class="nf">.long</span> <span class="mi">45</span>
</span><span class='line'><span class="nf">.long</span> <span class="mi">56</span>
</span><span class='line'><span class="nf">.long</span> <span class="mi">67</span>
</span><span class='line'><span class="nf">.long</span> <span class="mi">78</span>
</span><span class='line'><span class="nf">.long</span> <span class="mi">89</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip; and then the <code>vector</code> initialized from it &hellip;`</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">leaq</span> <span class="o">-</span><span class="mi">17</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">rcx</span>
</span><span class='line'><span class="nf">movq</span>  <span class="o">-</span><span class="mi">80</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">rsi</span>
</span><span class='line'><span class="nf">movq</span>  <span class="o">-</span><span class="mi">72</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">rdx</span>
</span><span class='line'><span class="nf">leaq</span>  <span class="o">-</span><span class="mi">112</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">rax</span>
</span><span class='line'><span class="nf">movq</span>  <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>
</span><span class='line'><span class="nl">.LEHB0:</span>
</span><span class='line'><span class="nf">call</span>  <span class="nv">_ZNSt6vectorIiSaIiEEC1ESt16initializer_listIiERKS0_</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ignore this, it&rsquo;s just freeing up the <code>std::allocator</code> object that is
passed to the vector (the actual function signature for the constructor is</p>

<figure class='code'><figcaption><span>std::vector(std::initializer_list, std::allocator const&)&#8220;`)</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">```</span><span class="n">nasm</span>
</span><span class='line'><span class="p">.</span><span class="nl">LEHE0</span><span class="p">:</span>
</span><span class='line'>  <span class="n">leaq</span> <span class="o">-</span><span class="mi">17</span><span class="p">(</span><span class="o">%</span><span class="n">rbp</span><span class="p">),</span> <span class="o">%</span><span class="n">rax</span>
</span><span class='line'>  <span class="n">movq</span> <span class="o">%</span><span class="n">rax</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span>
</span><span class='line'>  <span class="n">call</span> <span class="n">_ZNSaIiED1Ev</span>
</span><span class='line'>  <span class="n">leaq</span> <span class="o">-</span><span class="mi">112</span><span class="p">(</span><span class="o">%</span><span class="n">rbp</span><span class="p">),</span> <span class="o">%</span><span class="n">rax</span>
</span><span class='line'>  <span class="n">movq</span> <span class="o">%</span><span class="n">rax</span><span class="p">,</span> <span class="o">-</span><span class="mi">32</span><span class="p">(</span><span class="o">%</span><span class="n">rbp</span><span class="p">)</span>
</span><span class='line'>  <span class="n">movq</span> <span class="o">-</span><span class="mi">32</span><span class="p">(</span><span class="o">%</span><span class="n">rbp</span><span class="p">),</span> <span class="o">%</span><span class="n">rax</span>
</span><span class='line'>  <span class="n">movq</span> <span class="o">%</span><span class="n">rax</span><span class="p">,</span> <span class="o">%</span><span class="n">rdi</span>
</span></code></pre></td></tr></table></div></figure>


<p>Aha &hellip; finally, the iteration, from beginning</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nl">.LEHB1:</span>
</span><span class='line'>  <span class="nf">call</span>    <span class="nv">_ZSt5beginISt6vectorIiSaIiEEEDTcldtfp_5beginEERT_</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">-</span><span class="mi">64</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">-</span><span class="mi">32</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">rax</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip; to end</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">call</span> <span class="nv">_ZSt3endISt6vectorIiSaIiEEEDTcldtfp_3endEERT_</span>
</span><span class='line'><span class="nf">movq</span>  <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">-</span><span class="mi">48</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">)</span>
</span><span class='line'><span class="nf">jmp</span>   <span class="nv">.L3</span>
</span></code></pre></td></tr></table></div></figure>


<p>Beginning of the loop: we take the value of the iterator &hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nl">.L4:</span>
</span><span class='line'>  <span class="nf">leaq</span>    <span class="o">-</span><span class="mi">64</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">rax</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>
</span><span class='line'>  <span class="nf">call</span>    <span class="nv">_ZNK9__gnu_cxx17__normal_iteratorIPiSt6vectorIiSaIiEEEdeEv</span>
</span><span class='line'>  <span class="nf">movl</span>    <span class="p">(</span><span class="o">%</span><span class="nb">rax</span><span class="p">),</span> <span class="o">%</span><span class="nb">eax</span>
</span><span class='line'>  <span class="nf">movl</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span> <span class="o">-</span><span class="mi">24</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">movl</span>    <span class="o">-</span><span class="mi">24</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">eax</span>
</span><span class='line'>  <span class="nf">movl</span>    <span class="o">%</span><span class="nb">eax</span><span class="p">,</span> <span class="o">%</span><span class="nb">esi</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip; and print it out.
(This is the <code>operator &lt;&lt;</code>, being called on the contents of <code>edi</code>,
which is <code>std::cout</code>)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">movl</span> <span class="kc">$</span><span class="nv">_ZSt4cout</span><span class="p">,</span> <span class="o">%</span><span class="nb">edi</span>
</span><span class='line'><span class="nf">call</span>  <span class="nv">_ZNSolsEi</span>
</span></code></pre></td></tr></table></div></figure>


<p>And this big mangled symbol is <code>std::endl</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">movl</span>
</span><span class='line'><span class="nf">$_ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_</span><span class="p">,</span> <span class="o">%</span><span class="nb">esi</span>
</span><span class='line'><span class="nf">movq</span>  <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>
</span><span class='line'><span class="nf">call</span>  <span class="nv">_ZNSolsEPFRSoS_E</span>
</span></code></pre></td></tr></table></div></figure>


<p>BTW a useful tool to find
unmangled symbols is <code>c++filt</code>, use it as</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>c++filt _ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_
</span><span class='line'>
</span><span class='line'>std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;<span class="p">&amp;</span> std::endl&lt;char,
</span><span class='line'>std::char_traits&lt;char&gt; &gt;<span class="o">(</span>std::basic_ostream&lt;char, std::char_traits&lt;char&gt;
</span><span class='line'>&gt;<span class="p">&amp;</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>I googled and found an <a href="http://slush.warosu.org/c++filtjs/">online version of the
same</a> but it wasn&rsquo;t always accurate, so
YMMV.</p>

<p>Moving on &hellip; then the iterator advances along the vector &hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">leaq</span> <span class="o">-</span><span class="mi">64</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">rax</span>
</span><span class='line'><span class="nf">movq</span>  <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>
</span><span class='line'><span class="nf">call</span>  <span class="nv">_ZN9__gnu_cxx17__normal_iteratorIPiSt6vectorIiSaIiEEEppEv</span>
</span><span class='line'><span class="nl">.L3:</span>
</span><span class='line'><span class="nf">leaq</span>  <span class="o">-</span><span class="mi">48</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">rdx</span>
</span><span class='line'><span class="nf">leaq</span>  <span class="o">-</span><span class="mi">64</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">rax</span>
</span><span class='line'><span class="nf">movq</span>  <span class="o">%</span><span class="nb">rdx</span><span class="p">,</span> <span class="o">%</span><span class="nb">rsi</span>
</span><span class='line'><span class="nf">movq</span>  <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip; and if we haven&rsquo;t reached the end yet, jump back to the beginning of
the loop (the <code>.L4</code> label above)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">call</span>
</span><span class='line'><span class="nf">_ZN9__gnu_cxxneIPiSt6vectorIiSaIiEEEEbRKNS_17__normal_iteratorIT_T0_EESA_</span>
</span><span class='line'><span class="nl">.LEHE1:</span>
</span><span class='line'><span class="nf">testb</span> <span class="o">%</span><span class="nb">al</span><span class="p">,</span> <span class="o">%</span><span class="nb">al</span>
</span><span class='line'><span class="nf">jne</span>   <span class="nv">.L4</span>
</span><span class='line'><span class="nf">leaq</span>  <span class="o">-</span><span class="mi">112</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">rax</span>
</span><span class='line'><span class="nf">movq</span>  <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>
</span></code></pre></td></tr></table></div></figure>


<p>When done, destroy the vector (with some error handling, so</p>

<figure class='code'><figcaption><span>_Unwind_Resume&#8220;`)</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="err">```</span><span class="nf">nasm</span>
</span><span class='line'><span class="nl">.LEHB2:</span>
</span><span class='line'>  <span class="nf">call</span>    <span class="nv">_ZNSt6vectorIiSaIiEED1Ev</span>
</span><span class='line'>  <span class="nf">movl</span>    <span class="kc">$</span><span class="mi">0</span><span class="p">,</span> <span class="o">%</span><span class="nb">eax</span>
</span><span class='line'>  <span class="nf">addq</span>    <span class="kc">$</span><span class="mi">120</span><span class="p">,</span> <span class="o">%</span><span class="nb">rsp</span>
</span><span class='line'>  <span class="nf">popq</span>    <span class="o">%</span><span class="nb">rbx</span>
</span><span class='line'>  <span class="nf">popq</span>    <span class="o">%</span><span class="nb">rbp</span>
</span><span class='line'>  <span class="nf">.cfi_remember_state</span>
</span><span class='line'>  <span class="nf">.cfi_def_cfa</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span>
</span><span class='line'>  <span class="nf">ret</span>
</span><span class='line'><span class="nl">.L7:</span>
</span><span class='line'>  <span class="nf">.cfi_restore_state</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rbx</span>
</span><span class='line'>  <span class="nf">leaq</span>    <span class="o">-</span><span class="mi">17</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">rax</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>
</span><span class='line'>  <span class="nf">call</span>    <span class="nv">_ZNSaIiED1Ev</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">%</span><span class="nb">rbx</span><span class="p">,</span> <span class="o">%</span><span class="nb">rax</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>
</span><span class='line'>  <span class="nf">call</span>    <span class="nv">_Unwind_Resume</span>
</span><span class='line'><span class="nl">.LEHE2:</span>
</span><span class='line'><span class="nl">.L8:</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rbx</span>
</span><span class='line'>  <span class="nf">leaq</span>    <span class="o">-</span><span class="mi">112</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">rax</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>
</span><span class='line'>  <span class="nf">call</span>    <span class="nv">_ZNSt6vectorIiSaIiEED1Ev</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">%</span><span class="nb">rbx</span><span class="p">,</span> <span class="o">%</span><span class="nb">rax</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>
</span><span class='line'><span class="nl">.LEHB3:</span>
</span><span class='line'>  <span class="nf">call</span>    <span class="nv">_Unwind_Resume</span>
</span><span class='line'><span class="nl">.LEHE3:</span>
</span><span class='line'>  <span class="nf">.cfi_endproc</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now I&rsquo;ve skipped <em>quite</em> a lot of the generated assembly, and you should
look at the gist I mentioned above for the code for each of the function
calls mentioned above, e.g. the code for
the &lsquo;beginning&rsquo; of the iterator:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nl">_ZSt5beginISt6vectorIiSaIiEEEDTcldtfp_5beginEERT_:</span>
</span><span class='line'><span class="nl">.LFB1564:</span>
</span><span class='line'>  <span class="nf">.cfi_startproc</span>
</span><span class='line'>  <span class="nf">pushq</span>   <span class="o">%</span><span class="nb">rbp</span>
</span><span class='line'>  <span class="nf">.cfi_def_cfa_offset</span> <span class="mi">16</span>
</span><span class='line'>  <span class="nf">.cfi_offset</span> <span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">16</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">%</span><span class="nb">rsp</span><span class="p">,</span> <span class="o">%</span><span class="nb">rbp</span>
</span><span class='line'>  <span class="nf">.cfi_def_cfa_register</span> <span class="mi">6</span>
</span><span class='line'>  <span class="nf">subq</span>    <span class="kc">$</span><span class="mi">16</span><span class="p">,</span> <span class="o">%</span><span class="nb">rsp</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">%</span><span class="nb">rdi</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">-</span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span> <span class="o">%</span><span class="nb">rax</span>
</span><span class='line'>  <span class="nf">movq</span>    <span class="o">%</span><span class="nb">rax</span><span class="p">,</span> <span class="o">%</span><span class="nb">rdi</span>
</span><span class='line'>  <span class="nf">call</span>    <span class="nv">_ZNSt6vectorIiSaIiEE5beginEv</span>
</span><span class='line'>  <span class="nf">leave</span>
</span><span class='line'>  <span class="nf">.cfi_def_cfa</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span>
</span><span class='line'>  <span class="nf">ret</span>
</span><span class='line'>  <span class="nf">.cfi_endproc</span>
</span></code></pre></td></tr></table></div></figure>


<p>(which wraps around a call to <code>std::vector::begin()</code>)</p>

<h2><code>For loop</code> iteration: Haskell (Basic lists)</h2>

<p>Here&rsquo;s a simple program that uses the standard <code>Prelude</code> list type.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="nf">x</span> <span class="ow">=</span> <span class="p">[</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">78</span> <span class="p">,</span><span class="mi">89</span> <span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="n">mapM_</span> <span class="n">print</span> <span class="n">x</span>
</span></code></pre></td></tr></table></div></figure>


<p>Full assembly is <a href="https://gist.github.com/agam/5194680">here</a> &hellip; and would
you believe it, it&rsquo;s one-fifth the size of the C++ assembly.</p>

<p>Based on our experience in the <a href="/posts/hello-world-comparison.html">Hello World
example</a>, the Haskell assembly won&rsquo;t
have a linear one-to-one mapping with the source, so let&rsquo;s start with the</p>

<figure class='code'><figcaption><span>main&#8220;` function.</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="p">```</span><span class="n">nasm</span>
</span><span class='line'><span class="o">.</span><span class="n">globl</span> <span class="kt">Main_main_info</span>
</span><span class='line'><span class="o">.</span><span class="kr">type</span> <span class="kt">Main_main_info</span><span class="p">,</span> <span class="o">@</span><span class="n">object</span>
</span><span class='line'><span class="kt">Main_main_info:</span>
</span><span class='line'><span class="o">.</span><span class="kt">Lcuj:</span>
</span><span class='line'>  <span class="n">leaq</span> <span class="o">-</span><span class="mi">16</span><span class="p">(</span><span class="o">%</span><span class="n">rbp</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
</span><span class='line'>  <span class="n">cmpq</span> <span class="o">%</span><span class="n">r15</span><span class="p">,</span><span class="o">%</span><span class="n">rax</span>
</span><span class='line'>  <span class="n">jb</span> <span class="o">.</span><span class="kt">Lcul</span>
</span><span class='line'>  <span class="n">addq</span> <span class="o">$</span><span class="mi">16</span><span class="p">,</span><span class="o">%</span><span class="n">r12</span>
</span><span class='line'>  <span class="n">cmpq</span> <span class="mi">144</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">),</span><span class="o">%</span><span class="n">r12</span>
</span><span class='line'>  <span class="n">ja</span> <span class="o">.</span><span class="kt">Lcun</span>
</span><span class='line'>  <span class="n">movq</span> <span class="o">$</span><span class="n">stg_CAF_BLACKHOLE_info</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="n">r12</span><span class="p">)</span>
</span><span class='line'>  <span class="n">movq</span> <span class="mi">160</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
</span><span class='line'>  <span class="n">movq</span> <span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="o">%</span><span class="n">r12</span><span class="p">)</span>
</span><span class='line'>  <span class="n">movq</span> <span class="o">%</span><span class="n">r13</span><span class="p">,</span><span class="o">%</span><span class="n">rdi</span>
</span><span class='line'>  <span class="n">movq</span> <span class="o">%</span><span class="n">rbx</span><span class="p">,</span><span class="o">%</span><span class="n">rsi</span>
</span><span class='line'>  <span class="n">leaq</span> <span class="o">-</span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="n">r12</span><span class="p">),</span><span class="o">%</span><span class="n">rdx</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once again, we see the <code>CAF</code> allocation</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">subq</span> <span class="kc">$</span><span class="mi">8</span><span class="p">,</span><span class="o">%</span><span class="nb">rsp</span>
</span><span class='line'><span class="nf">movl</span> <span class="kc">$</span><span class="mi">0</span><span class="p">,</span><span class="o">%</span><span class="nb">eax</span>
</span><span class='line'><span class="nf">call</span> <span class="nv">newCAF</span>
</span><span class='line'><span class="nf">addq</span> <span class="kc">$</span><span class="mi">8</span><span class="p">,</span><span class="o">%</span><span class="nb">rsp</span>
</span><span class='line'><span class="nf">testq</span> <span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="o">%</span><span class="nb">rax</span>
</span><span class='line'><span class="nf">je</span> <span class="nv">.Lcuo</span>
</span><span class='line'><span class="nl">.Lcup:</span>
</span><span class='line'><span class="nf">movq</span> <span class="kc">$</span><span class="nv">stg_bh_upd_frame_info</span><span class="p">,</span><span class="o">-</span><span class="mi">16</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">)</span>
</span><span class='line'><span class="nf">leaq</span> <span class="o">-</span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">),</span><span class="o">%</span><span class="nb">rax</span>
</span><span class='line'><span class="nf">movq</span> <span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Somewhat boring &hellip; it uses <code>Control::MapM</code> and <code>
GHC::Base::IO</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">movl</span> <span class="kc">$</span><span class="nv">base_ControlziMonad_mapMzu_closure</span><span class="p">,</span><span class="o">%</span><span class="nb">ebx</span>
</span><span class='line'><span class="nf">movl</span> <span class="kc">$</span><span class="nv">base_GHCziBase_zdfMonadIO_closure</span><span class="p">,</span><span class="o">%</span><span class="nb">r14d</span>
</span><span class='line'><span class="nf">movl</span> <span class="kc">$</span><span class="nv">stc_closure</span><span class="p">,</span><span class="o">%</span><span class="nb">esi</span>
</span><span class='line'><span class="nf">movl</span> <span class="kc">$</span><span class="nv">stb_closure</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">%</span><span class="nb">edi</span>
</span><span class='line'><span class="nf">addq</span> <span class="kc">$</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="o">%</span><span class="nb">rbp</span>
</span><span class='line'><span class="nf">jmp</span> <span class="nv">stg_ap_ppp_fast</span>
</span><span class='line'><span class="nl">.Lcun:</span>
</span><span class='line'><span class="nf">movq</span> <span class="kc">$</span><span class="mi">16</span><span class="p">,</span><span class="mi">192</span><span class="p">(</span><span class="o">%</span><span class="nv">r13</span><span class="p">)</span>
</span><span class='line'><span class="nl">.Lcul:</span>
</span><span class='line'><span class="nf">jmp</span> <span class="o">*-</span><span class="mi">16</span><span class="p">(</span><span class="o">%</span><span class="nv">r13</span><span class="p">)</span>
</span><span class='line'><span class="nl">.Lcuo:</span>
</span><span class='line'><span class="nf">jmp</span> <span class="o">*</span><span class="p">(</span><span class="o">%</span><span class="nb">rbx</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip; which in turn is defined as (skipping the usual paperwork of</p>

<figure class='code'><figcaption><span>newCAF&#8220;` and &#8220;`stg_CAF_BLACKHOLE_info&#8220;`)</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="p">```</span><span class="n">nasm</span>
</span><span class='line'><span class="o">.</span><span class="kt">Lcu2:</span>
</span><span class='line'>  <span class="n">movq</span> <span class="o">$</span><span class="n">stg_bh_upd_frame_info</span><span class="p">,</span><span class="o">-</span><span class="mi">16</span><span class="p">(</span><span class="o">%</span><span class="n">rbp</span><span class="p">)</span>
</span><span class='line'>  <span class="n">leaq</span> <span class="o">-</span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="n">r12</span><span class="p">),</span><span class="o">%</span><span class="n">rax</span>
</span><span class='line'>  <span class="n">movq</span> <span class="o">%</span><span class="n">rax</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="n">rbp</span><span class="p">)</span>
</span><span class='line'>  <span class="n">movl</span> <span class="o">$</span><span class="n">base_SystemziIO_print_closure</span><span class="p">,</span><span class="o">%</span><span class="n">ebx</span>
</span><span class='line'>  <span class="n">movl</span> <span class="o">$</span><span class="n">base_GHCziShow_zdfShowInteger_closure</span><span class="p">,</span><span class="o">%</span><span class="n">r14d</span>
</span><span class='line'>  <span class="n">addq</span> <span class="o">$-</span><span class="mi">16</span><span class="p">,</span><span class="o">%</span><span class="n">rbp</span>
</span><span class='line'>  <span class="n">jmp</span> <span class="n">stg_ap_p_fast</span>
</span><span class='line'><span class="o">.</span><span class="kt">Lcu0:</span>
</span><span class='line'>  <span class="n">movq</span> <span class="o">$</span><span class="mi">16</span><span class="p">,</span><span class="mi">192</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">)</span>
</span><span class='line'><span class="o">.</span><span class="kt">LctY:</span>
</span><span class='line'>  <span class="n">jmp</span> <span class="o">*-</span><span class="mi">16</span><span class="p">(</span><span class="o">%</span><span class="n">r13</span><span class="p">)</span>
</span><span class='line'><span class="o">.</span><span class="kt">Lcu1:</span>
</span><span class='line'>  <span class="n">jmp</span> <span class="o">*</span><span class="p">(</span><span class="o">%</span><span class="n">rbx</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>(using <code>System::IO::print</code> and <code>GHC::Show::ShowInteger</code>)</p>

<p>So nothing much to directly glean here &mdash; iteration isn&rsquo;t anything special
in haskell, it&rsquo;s another function call.</p>

<p>The assembly for the data is incredibly verbose, on the lines of</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">.data</span>
</span><span class='line'>  <span class="nf">.align</span> <span class="mi">8</span>
</span><span class='line'><span class="nf">.align</span> <span class="mi">1</span>
</span><span class='line'><span class="nl">ssX_closure:</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="nv">integerzmgmp_GHCziIntegerziType_Szh_static_info</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="mi">56</span>
</span><span class='line'><span class="nf">.data</span>
</span><span class='line'>  <span class="nf">.align</span> <span class="mi">8</span>
</span><span class='line'><span class="nf">.align</span> <span class="mi">1</span>
</span><span class='line'><span class="nl">ssZ_closure:</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="nv">ghczmprim_GHCziTypes_ZC_static_info</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="nb">ss</span><span class="nv">X_closure</span><span class="o">+</span><span class="mi">1</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="nb">ss</span><span class="nv">W_closure</span><span class="o">+</span><span class="mi">2</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'><span class="nf">...</span>
</span><span class='line'><span class="nf">...</span>
</span><span class='line'><span class="nf">...</span>
</span><span class='line'>
</span><span class='line'><span class="nf">.data</span>
</span><span class='line'>  <span class="nf">.align</span> <span class="mi">8</span>
</span><span class='line'><span class="nf">.align</span> <span class="mi">1</span>
</span><span class='line'><span class="nl">st6_closure:</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="nv">integerzmgmp_GHCziIntegerziType_Szh_static_info</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="mi">23</span>
</span><span class='line'><span class="nf">.data</span>
</span><span class='line'>  <span class="nf">.align</span> <span class="mi">8</span>
</span><span class='line'><span class="nf">.align</span> <span class="mi">1</span>
</span><span class='line'><span class="nl">st8_closure:</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="nv">ghczmprim_GHCziTypes_ZC_static_info</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="nb">st6</span><span class="nv">_closure</span><span class="o">+</span><span class="mi">1</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="nb">st5</span><span class="nv">_closure</span><span class="o">+</span><span class="mi">2</span>
</span><span class='line'>  <span class="nf">.quad</span>   <span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure>


<h2><code>For loop</code> iteration: Haskell (Other list structures)</h2>

<p>Let&rsquo;s look at a different kind of list in haskell</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kr">import</span> <span class="nn">Prelude</span> <span class="k">hiding</span> <span class="p">(</span><span class="nf">mapM_</span><span class="p">);</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">Data.Sequence</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">Data.Foldable</span> <span class="p">(</span><span class="nf">mapM_</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nf">x</span> <span class="ow">=</span> <span class="kt">Data</span><span class="o">.</span><span class="kt">Sequence</span><span class="o">.</span><span class="n">singleton</span> <span class="mi">12</span> <span class="o">|&gt;</span> <span class="mi">23</span> <span class="o">|&gt;</span> <span class="mi">34</span> <span class="o">|&gt;</span> <span class="mi">45</span> <span class="o">|&gt;</span> <span class="mi">56</span> <span class="o">|&gt;</span> <span class="mi">67</span> <span class="o">|&gt;</span> <span class="mi">78</span>  <span class="o">|&gt;</span> <span class="mi">89</span>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="n">mapM_</span>  <span class="n">print</span>  <span class="n">x</span>
</span></code></pre></td></tr></table></div></figure>


<p>(Assembly <a href="https://gist.github.com/agam/5202781">here</a>)</p>

<p>The cells of this sequence are still constructed in what seems to me a bit
heavyweight manner:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nl">sEH_info:</span>
</span><span class='line'><span class="nl">.LcGi:</span>
</span><span class='line'>  <span class="nf">leaq</span> <span class="o">-</span><span class="mi">16</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">),</span><span class="o">%</span><span class="nb">rax</span>
</span><span class='line'>  <span class="nf">cmpq</span> <span class="o">%</span><span class="nv">r15</span><span class="p">,</span><span class="o">%</span><span class="nb">rax</span>
</span><span class='line'>  <span class="nf">jb</span> <span class="nv">.LcGk</span>
</span><span class='line'>  <span class="nf">addq</span> <span class="kc">$</span><span class="mi">32</span><span class="p">,</span><span class="o">%</span><span class="nv">r12</span>
</span><span class='line'>  <span class="nf">cmpq</span> <span class="mi">144</span><span class="p">(</span><span class="o">%</span><span class="nv">r13</span><span class="p">),</span><span class="o">%</span><span class="nv">r12</span>
</span><span class='line'>  <span class="nf">ja</span> <span class="nv">.LcGm</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="kc">$</span><span class="nv">stg_upd_frame_info</span><span class="p">,</span><span class="o">-</span><span class="mi">16</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="o">%</span><span class="nb">rbx</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="nb">rbp</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="kc">$</span><span class="nv">integerzmgmp_GHCziIntegerziType_Szh_con_info</span><span class="p">,</span><span class="o">-</span><span class="mi">24</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="kc">$</span><span class="mi">67</span><span class="p">,</span><span class="o">-</span><span class="mi">16</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="kc">$</span><span class="nv">sED_info</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">movl</span> <span class="kc">$</span><span class="nv">containerszm0zi4zi2zi1_DataziSequence_zbzg_closure</span><span class="p">,</span><span class="o">%</span><span class="nb">ebx</span>
</span><span class='line'>  <span class="nf">leaq</span> <span class="o">-</span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">),</span><span class="o">%</span><span class="nv">r14</span>
</span><span class='line'>  <span class="nf">leaq</span> <span class="o">-</span><span class="mi">23</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">),</span><span class="o">%</span><span class="nb">rsi</span>
</span><span class='line'>  <span class="nf">addq</span> <span class="kc">$</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="o">%</span><span class="nb">rbp</span>
</span><span class='line'>  <span class="nf">jmp</span> <span class="nv">stg_ap_pp_fast</span>
</span><span class='line'><span class="nl">.LcGm:</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="kc">$</span><span class="mi">32</span><span class="p">,</span><span class="mi">192</span><span class="p">(</span><span class="o">%</span><span class="nv">r13</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>(This extract shows the closure that adds <code>67</code> in the list)</p>

<p>It&rsquo;s possible to construct this directly from a finite list, and the same
can be done for the <code>Data.Vector</code> type too :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kr">import</span> <span class="nn">Prelude</span> <span class="k">hiding</span> <span class="p">(</span><span class="nf">mapM_</span><span class="p">);</span>
</span><span class='line'><span class="kr">import</span> <span class="nn">Data.Vector</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nf">x</span> <span class="ow">=</span> <span class="kt">Data</span><span class="o">.</span><span class="kt">Vector</span><span class="o">.</span><span class="n">fromList</span> <span class="p">[</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">89</span> <span class="p">]</span>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="n">mapM_</span>  <span class="n">print</span>  <span class="n">x</span>
</span></code></pre></td></tr></table></div></figure>


<p>(Assembly <a href="https://gist.github.com/agam/5202839">here</a>)</p>

<p>The vector is still constructed piece by piece though:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">movq</span> <span class="kc">$</span><span class="mi">23</span><span class="p">,</span><span class="o">-</span><span class="mi">64</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'><span class="nf">movq</span> <span class="kc">$</span><span class="nv">ghczmprim_GHCziTypes_ZC_con_info</span><span class="p">,</span><span class="o">-</span><span class="mi">56</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'><span class="nf">leaq</span> <span class="o">-</span><span class="mi">71</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">),</span><span class="o">%</span><span class="nb">rax</span>
</span><span class='line'><span class="nf">movq</span> <span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="o">-</span><span class="mi">48</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'><span class="nf">leaq</span> <span class="o">-</span><span class="mi">94</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">),</span><span class="o">%</span><span class="nb">rax</span>
</span><span class='line'><span class="nf">movq</span> <span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'><span class="nf">movq</span> <span class="kc">$</span><span class="nv">integerzmgmp_GHCziIntegerziType_Szh_con_info</span><span class="p">,</span><span class="o">-</span><span class="mi">32</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'><span class="nf">movq</span> <span class="kc">$</span><span class="mi">12</span><span class="p">,</span><span class="o">-</span><span class="mi">24</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'><span class="nf">movq</span> <span class="kc">$</span><span class="nv">ghczmprim_GHCziTypes_ZC_con_info</span><span class="p">,</span><span class="o">-</span><span class="mi">16</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'><span class="nf">leaq</span> <span class="o">-</span><span class="mi">31</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">),</span><span class="o">%</span><span class="nb">rax</span>
</span><span class='line'><span class="nf">movq</span> <span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'><span class="nf">leaq</span> <span class="o">-</span><span class="mi">54</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">),</span><span class="o">%</span><span class="nb">rax</span>
</span><span class='line'><span class="nf">movq</span> <span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'><span class="nf">movl</span> <span class="kc">$</span><span class="nv">vectorzm0zi9zi1_DataziVector_fromList_closure</span><span class="p">,</span><span class="o">%</span><span class="nb">ebx</span>
</span><span class='line'><span class="nf">leaq</span> <span class="o">-</span><span class="mi">14</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">),</span><span class="o">%</span><span class="nv">r14</span>
</span><span class='line'><span class="nf">addq</span> <span class="kc">$</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="o">%</span><span class="nb">rbp</span>
</span><span class='line'><span class="nf">jmp</span> <span class="nv">stg_ap_p_fast</span>
</span></code></pre></td></tr></table></div></figure>


<p>(This extract shows the steps for picking up 23 and 12 (skipping similar
steps for the other numbers)</p>

<p>I was curious if there was a way to avoid constructing the list</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kr">import</span> <span class="nn">Data.Vector.Unboxed</span> <span class="k">as</span> <span class="n">U</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nf">x</span> <span class="ow">::</span> <span class="kt">U</span><span class="o">.</span><span class="kt">Vector</span> <span class="kt">Double</span>
</span><span class='line'><span class="nf">x</span> <span class="ow">=</span> <span class="kt">U</span><span class="o">.</span><span class="n">fromList</span> <span class="p">[</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">89</span> <span class="p">]</span>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="kt">U</span><span class="o">.</span><span class="n">foldr</span> <span class="p">((</span><span class="o">&gt;&gt;</span><span class="p">)</span> <span class="o">.</span> <span class="n">print</span><span class="p">)</span> <span class="p">(</span><span class="n">return</span> <span class="nb">()</span><span class="p">)</span>  <span class="n">x</span>
</span></code></pre></td></tr></table></div></figure>


<p>(Assembly <a href="https://gist.github.com/agam/5203008">here</a>)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">...</span>
</span><span class='line'><span class="nf">...</span> <span class="p">(</span><span class="nv">skipping</span> <span class="nv">numbers</span> <span class="nv">after</span> <span class="mi">23</span><span class="p">)</span>
</span><span class='line'><span class="nf">...</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="kc">$</span><span class="mi">23</span><span class="p">,</span><span class="o">-</span><span class="mi">48</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="kc">$</span><span class="nv">ghczmprim_GHCziTypes_ZC_con_info</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">leaq</span> <span class="o">-</span><span class="mi">55</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">),</span><span class="o">%</span><span class="nb">rax</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="o">-</span><span class="mi">32</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">leaq</span> <span class="o">-</span><span class="mi">78</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">),</span><span class="o">%</span><span class="nb">rax</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="o">-</span><span class="mi">24</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="kc">$</span><span class="nv">ghczmprim_GHCziTypes_ZC_con_info</span><span class="p">,</span><span class="o">-</span><span class="mi">16</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="kc">$</span><span class="nv">stg_INTLIKE_closure</span><span class="o">+</span><span class="mi">449</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">leaq</span> <span class="o">-</span><span class="mi">38</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">),</span><span class="o">%</span><span class="nb">rax</span>
</span><span class='line'>  <span class="nf">movq</span> <span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="mi">0</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">)</span>
</span><span class='line'>  <span class="nf">movl</span> <span class="kc">$</span><span class="nv">vectorzm0zi9zi1_DataziVectorziUnboxed_fromList_closure</span><span class="p">,</span><span class="o">%</span><span class="nb">ebx</span>
</span><span class='line'>  <span class="nf">movl</span>
</span><span class='line'><span class="nf">$vectorzm0zi9zi1_DataziVectorziUnboxedziBase_zdfUnboxInt_closure</span><span class="p">,</span><span class="o">%</span><span class="nb">r14d</span>
</span><span class='line'>  <span class="nf">leaq</span> <span class="o">-</span><span class="mi">14</span><span class="p">(</span><span class="o">%</span><span class="nv">r12</span><span class="p">),</span><span class="o">%</span><span class="nb">rsi</span>
</span><span class='line'>  <span class="nf">addq</span> <span class="kc">$</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="o">%</span><span class="nb">rbp</span>
</span><span class='line'>  <span class="nf">jmp</span> <span class="nv">stg_ap_pp_fast</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this case, looking at <code>Core</code> might help.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="kt">Main</span><span class="o">.</span><span class="n">main</span> <span class="ow">::</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">IO</span> <span class="nb">()</span>
</span><span class='line'><span class="p">[</span><span class="kt">LclIdX</span><span class="p">]</span>
</span><span class='line'><span class="kt">Main</span><span class="o">.</span><span class="n">main</span> <span class="ow">=</span>
</span><span class='line'>  <span class="kt">Data</span><span class="o">.</span><span class="kt">Vector</span><span class="o">.</span><span class="kt">Unboxed</span><span class="o">.</span><span class="n">foldr</span>
</span><span class='line'>    <span class="o">@</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">Int</span>
</span><span class='line'>    <span class="o">@</span> <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">IO</span> <span class="nb">()</span><span class="p">)</span>
</span><span class='line'>    <span class="kt">Data</span><span class="o">.</span><span class="kt">Vector</span><span class="o">.</span><span class="kt">Unboxed</span><span class="o">.</span><span class="kt">Base</span><span class="o">.$</span><span class="n">fUnboxInt</span>
</span><span class='line'>    <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Base</span><span class="o">..</span>
</span><span class='line'>       <span class="o">@</span> <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">IO</span> <span class="nb">()</span><span class="p">)</span>
</span><span class='line'>       <span class="o">@</span> <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">IO</span> <span class="nb">()</span> <span class="ow">-&gt;</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">IO</span> <span class="nb">()</span><span class="p">)</span>
</span><span class='line'>       <span class="o">@</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">Int</span>
</span><span class='line'>       <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Base</span><span class="o">.&gt;&gt;</span> <span class="o">@</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">IO</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Base</span><span class="o">.$</span><span class="n">fMonadIO</span> <span class="o">@</span> <span class="nb">()</span> <span class="o">@</span> <span class="nb">()</span><span class="p">)</span>
</span><span class='line'>       <span class="p">(</span><span class="kt">System</span><span class="o">.</span><span class="kt">IO</span><span class="o">.</span><span class="n">print</span> <span class="o">@</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">Int</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Show</span><span class="o">.$</span><span class="n">fShowInt</span><span class="p">))</span>
</span><span class='line'>    <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Base</span><span class="o">.</span><span class="n">return</span>
</span><span class='line'>       <span class="o">@</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">IO</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Base</span><span class="o">.$</span><span class="n">fMonadIO</span> <span class="o">@</span> <span class="nb">()</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Tuple</span><span class="o">.</span><span class="nb">()</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="kt">Data</span><span class="o">.</span><span class="kt">Vector</span><span class="o">.</span><span class="kt">Unboxed</span><span class="o">.</span><span class="n">fromList</span>
</span><span class='line'>       <span class="o">@</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">Int</span>
</span><span class='line'>       <span class="kt">Data</span><span class="o">.</span><span class="kt">Vector</span><span class="o">.</span><span class="kt">Unboxed</span><span class="o">.</span><span class="kt">Base</span><span class="o">.$</span><span class="n">fUnboxInt</span>
</span><span class='line'>       <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.:</span>
</span><span class='line'>          <span class="o">@</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">Int</span>
</span><span class='line'>          <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">I</span><span class="o">#</span> <span class="mi">12</span><span class="p">)</span>
</span><span class='line'>          <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.:</span>
</span><span class='line'>             <span class="o">@</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">Int</span>
</span><span class='line'>             <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">I</span><span class="o">#</span> <span class="mi">23</span><span class="p">)</span>
</span><span class='line'>             <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.:</span>
</span><span class='line'>                <span class="o">@</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">Int</span>
</span><span class='line'>                <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">I</span><span class="o">#</span> <span class="mi">34</span><span class="p">)</span>
</span><span class='line'>                <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.:</span>
</span><span class='line'>                   <span class="o">@</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">Int</span>
</span><span class='line'>                   <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">I</span><span class="o">#</span> <span class="mi">45</span><span class="p">)</span>
</span><span class='line'>                   <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.:</span>
</span><span class='line'>                      <span class="o">@</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">Int</span>
</span><span class='line'>                      <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">I</span><span class="o">#</span> <span class="mi">56</span><span class="p">)</span>
</span><span class='line'>                      <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.:</span>
</span><span class='line'>                         <span class="o">@</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">Int</span>
</span><span class='line'>                         <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">I</span><span class="o">#</span> <span class="mi">67</span><span class="p">)</span>
</span><span class='line'>                         <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.:</span>
</span><span class='line'>                            <span class="o">@</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">Int</span>
</span><span class='line'>                            <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">I</span><span class="o">#</span> <span class="mi">78</span><span class="p">)</span>
</span><span class='line'>                            <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.:</span>
</span><span class='line'>                               <span class="o">@</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">Int</span>
</span><span class='line'>                               <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">I</span><span class="o">#</span> <span class="mi">89</span><span class="p">)</span>
</span><span class='line'>                               <span class="p">(</span><span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">[]</span> <span class="o">@</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">Int</span><span class="p">))))))))))</span>
</span><span class='line'>
</span><span class='line'><span class="kt">:Main</span><span class="o">.</span><span class="n">main</span> <span class="ow">::</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">Types</span><span class="o">.</span><span class="kt">IO</span> <span class="nb">()</span>
</span><span class='line'><span class="p">[</span><span class="kt">LclIdX</span><span class="p">]</span>
</span><span class='line'><span class="kt">:Main</span><span class="o">.</span><span class="n">main</span> <span class="ow">=</span> <span class="kt">GHC</span><span class="o">.</span><span class="kt">TopHandler</span><span class="o">.</span><span class="n">runMainIO</span> <span class="o">@</span> <span class="nb">()</span> <span class="kt">Main</span><span class="o">.</span><span class="n">main</span>
</span></code></pre></td></tr></table></div></figure>


<p>But no, even in the case of a <code>Data.Vector.Unboxed</code>, the representation
for the array data is never as compact as the C++ version.</p>

<p>In terms of running speed though (again, printing out tiny lists is a poor,
poor benchmark, but still) it seems close enough:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">time</span> <span class="o">(</span><span class="k">while</span> <span class="o">((</span>n++ &lt; 100<span class="o">))</span><span class="p">;</span> <span class="k">do</span> ./simpleloopcpp<span class="p">;</span> <span class="k">done</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>real  0m0.312s
</span><span class='line'>user  0m0.016s
</span><span class='line'>sys   0m0.044s
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span><span class="nb">time</span> <span class="o">(</span><span class="k">while</span> <span class="o">((</span>n++ &lt; 100<span class="o">))</span><span class="p">;</span> <span class="k">do</span> ./simpleloophaskell<span class="p">;</span> <span class="k">done</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>real  0m0.355s
</span><span class='line'>user  0m0.024s
</span><span class='line'>sys   0m0.060s
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-03-13T00:00:00+00:00" pubdate data-updated="true">Mar 13<sup>th</sup>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/assembly/'>assembly</a>, <a class='category' href='/blog/categories/c-plus-plus/'>c++</a>, <a class='category' href='/blog/categories/haskell/'>haskell</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/03/12/hello-world-in-go-compared/">
		
			Comparing &#8216;Hello World&#8217; in Go</a>
	</h2>
	<div class="entry-content">
		<p>Since I looked at printing &ldquo;Hello World&rdquo; <a href="/posts/hello-world-comparison.html">in C and Haskell earlier</a>, I thought I would look at what <em><a href="http://golang.org/">Go</a></em> does diferently.</p>

<h2>Source program</h2>

<p>So we start with this</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='go'><span class='line'><span class="kn">package</span> <span class="nx">main</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="s">&quot;fmt&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello, World&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Binary info</h2>

<p>The generated binary is large, like haskell, since (like haskell) it has a runtime linked in</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>ls -lh <span class="p">|</span> grep <span class="s1">&#39;\-x\-&#39;</span>
</span><span class='line'>-rwxr-x--- <span class="m">1</span> agam eng 1.1M Mar <span class="m">10</span> 17:27 haskellhelloworld
</span><span class='line'>-rwxr-x--- <span class="m">1</span> agam eng 8.8K Dec <span class="m">14</span> 16:10 helloworldcpp
</span><span class='line'>-rwxr-x--- <span class="m">1</span> agam eng 1.3M Mar <span class="m">12</span> 18:07 helloworldgo
</span></code></pre></td></tr></table></div></figure>


<p>It does define an intermediate number of symbols though:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>nm helloworldgo <span class="p">|</span> wc -l
</span><span class='line'>1748
</span></code></pre></td></tr></table></div></figure>


<p>Unlike both C++ and Haskell though (and this is really impressive) the Go binary is statically linked. So presumably I can copy it to a different location and expect it to run without worry too much about the environment (although I don&rsquo;t know if this is true for all supported libraries (i.e. there might be certain Go libraries that don&rsquo;t allow static linking)).</p>

<h2>Object code</h2>

<p>To see the generated assembly, run the following (the <code>sed</code> here is to get rid of the filename + linenumber that shows up on every line).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>go build -gcflags<span class="o">=</span>-S helloworld.go  <span class="p">|</span> sed <span class="s1">&#39;s/([^ ]*)//&#39;</span> &gt; helloworldgo.s
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ve <a href="https://gist.github.com/agam/5148575">saved the output in one piece</a> if you want to look at it.</p>

<p>The assembly format here looks very different from what we saw before; that&rsquo;s because it&rsquo;s in the <a href="http://doc.cat-v.org/plan_9/4th_edition/papers/asm">Plan 9 assembler</a> format, and it&rsquo;s a bit confusing since it introduces new pseudo-instructions and pseudo-registers.</p>

<p>Luckily, the generated assembly is somewhat annotated so it is much easier to follow along.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="err">---</span> <span class="nf">prog</span> <span class="nv">list</span> <span class="s">&quot;main&quot;</span> <span class="o">---</span>
</span><span class='line'><span class="err">0000</span>  <span class="nf">TEXT</span>    <span class="nv">main</span><span class="o">+</span><span class="mi">0</span><span class="p">(</span><span class="nv">SB</span><span class="p">),</span><span class="kc">$</span><span class="mi">72</span><span class="o">-</span><span class="mi">0</span>
</span><span class='line'><span class="err">0001</span>  <span class="nf">LEAQ</span>    <span class="nv">autotmp_0002</span><span class="o">+-</span><span class="mi">16</span><span class="p">(</span><span class="nb">SP</span><span class="p">),</span><span class="nb">DI</span>
</span><span class='line'><span class="err">0002</span>  <span class="nf">MOVQ</span>    <span class="kc">$</span><span class="mi">0</span><span class="p">,</span><span class="nb">AX</span>
</span><span class='line'><span class="err">0003</span>  <span class="nf">STOSQ</span>   <span class="p">,</span>
</span><span class='line'><span class="err">0004</span>  <span class="nf">STOSQ</span>   <span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>


<p>I was confused by the <code>autotmp_000x</code> all over the code, until I looked at the <a href="http://golang.org/src/cmd/gc/gen.c">corresponding runtime code</a> and realized these were unique names for temporary variables in the original code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="err">0005</span>  <span class="nf">LEAQ</span>    <span class="nv">autotmp_0002</span><span class="o">+-</span><span class="mi">16</span><span class="p">(</span><span class="nb">SP</span><span class="p">),</span><span class="nb">BX</span>
</span><span class='line'><span class="err">0006</span>  <span class="nf">MOVL</span>    <span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="nv">autotmp_0000</span><span class="o">+-</span><span class="mi">24</span><span class="p">(</span><span class="nb">SP</span><span class="p">)</span>
</span><span class='line'><span class="err">0007</span>  <span class="nf">MOVL</span>    <span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="nv">autotmp_0000</span><span class="o">+-</span><span class="mi">20</span><span class="p">(</span><span class="nb">SP</span><span class="p">)</span>
</span><span class='line'><span class="err">0008</span>  <span class="nf">MOVQ</span>    <span class="nb">BX</span><span class="p">,</span><span class="nv">autotmp_0000</span><span class="o">+-</span><span class="mi">32</span><span class="p">(</span><span class="nb">SP</span><span class="p">)</span>
</span><span class='line'><span class="err">0009</span>  <span class="nf">MOVQ</span>    <span class="kc">$</span><span class="nv">type.string</span><span class="o">+</span><span class="mi">0</span><span class="p">(</span><span class="nv">SB</span><span class="p">),(</span><span class="nb">SP</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Raw data, such as the string &ldquo;Hello, World&rdquo; here, <a href="http://golang.org/src/pkg/runtime/iface.c">have to be converted</a> to types within the program.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="err">0010</span>  <span class="nf">LEAQ</span>    <span class="nv">go.string.</span><span class="s">&quot;Hello, World&quot;</span><span class="o">+</span><span class="mi">0</span><span class="p">(</span><span class="nv">SB</span><span class="p">),</span><span class="nb">SI</span>
</span><span class='line'><span class="err">0011</span>  <span class="nf">LEAQ</span>    <span class="mi">8</span><span class="p">(</span><span class="nb">SP</span><span class="p">),</span><span class="nb">DI</span>
</span><span class='line'><span class="err">0012</span>  <span class="nf">MOVSQ</span>   <span class="p">,</span>
</span><span class='line'><span class="err">0013</span>  <span class="nf">MOVSQ</span>   <span class="p">,</span>
</span><span class='line'><span class="err">0014</span>  <span class="nf">CALL</span>    <span class="p">,</span><span class="nv">runtime.convT2E</span><span class="o">+</span><span class="mi">0</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span>
</span><span class='line'><span class="err">0015</span>  <span class="nf">LEAQ</span>    <span class="mi">24</span><span class="p">(</span><span class="nb">SP</span><span class="p">),</span><span class="nb">SI</span>
</span><span class='line'><span class="err">0016</span>  <span class="nf">LEAQ</span>    <span class="nv">autotmp_0000</span><span class="o">+-</span><span class="mi">32</span><span class="p">(</span><span class="nb">SP</span><span class="p">),</span><span class="nb">DI</span>
</span><span class='line'><span class="err">0017</span>  <span class="nf">MOVQ</span>    <span class="p">(</span><span class="nb">DI</span><span class="p">),</span><span class="nb">DI</span>
</span><span class='line'><span class="err">0018</span>  <span class="nf">MOVSQ</span>   <span class="p">,</span>
</span><span class='line'><span class="err">0019</span>  <span class="nf">MOVSQ</span>   <span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>


<p>Not sure here &hellip; looks like the string is being copied, as an argument to <code>fmt.Println</code> ?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="err">0020</span>  <span class="nf">LEAQ</span>    <span class="p">(</span><span class="nb">SP</span><span class="p">),</span><span class="nb">BX</span>
</span><span class='line'><span class="err">0021</span>  <span class="nf">MOVQ</span>    <span class="nv">autotmp_0000</span><span class="o">+-</span><span class="mi">32</span><span class="p">(</span><span class="nb">SP</span><span class="p">),</span><span class="nb">BP</span>
</span><span class='line'><span class="err">0022</span>  <span class="nf">MOVQ</span>    <span class="nb">BP</span><span class="p">,(</span><span class="nb">BX</span><span class="p">)</span>
</span><span class='line'><span class="err">0023</span>  <span class="nf">MOVL</span>    <span class="nv">autotmp_0000</span><span class="o">+-</span><span class="mi">24</span><span class="p">(</span><span class="nb">SP</span><span class="p">),</span><span class="nb">BP</span>
</span><span class='line'><span class="err">0024</span>  <span class="nf">MOVL</span>    <span class="nb">BP</span><span class="p">,</span><span class="mi">8</span><span class="p">(</span><span class="nb">BX</span><span class="p">)</span>
</span><span class='line'><span class="err">0025</span>  <span class="nf">MOVL</span>    <span class="nv">autotmp_0000</span><span class="o">+-</span><span class="mi">20</span><span class="p">(</span><span class="nb">SP</span><span class="p">),</span><span class="nb">BP</span>
</span><span class='line'><span class="err">0026</span>  <span class="nf">MOVL</span>    <span class="nb">BP</span><span class="p">,</span><span class="mi">12</span><span class="p">(</span><span class="nb">BX</span><span class="p">)</span>
</span><span class='line'><span class="err">0027</span>  <span class="nf">CALL</span>    <span class="p">,</span><span class="nv">fmt.Println</span><span class="o">+</span><span class="mi">0</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span>
</span><span class='line'><span class="err">0028</span>  <span class="nf">RET</span>     <span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>


<p>General runtime initialization &hellip; including a call to <code>fmt.init</code> to initialize static data in the <code>fmt</code> package.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="err">---</span> <span class="nf">prog</span> <span class="nv">list</span> <span class="s">&quot;init&quot;</span> <span class="o">---</span>
</span><span class='line'><span class="err">0029</span>  <span class="nf">TEXT</span>    <span class="nv">init</span><span class="o">+</span><span class="mi">0</span><span class="p">(</span><span class="nv">SB</span><span class="p">),</span><span class="kc">$</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span>
</span><span class='line'><span class="err">0030</span>  <span class="nf">MOVB</span>    <span class="nv">initdone</span><span class="err">·</span><span class="o">+</span><span class="mi">0</span><span class="p">(</span><span class="nv">SB</span><span class="p">),</span><span class="nb">AX</span>
</span><span class='line'><span class="err">0031</span>  <span class="nf">MOVB</span>    <span class="nb">AX</span><span class="p">,</span><span class="nb">BX</span>
</span><span class='line'><span class="err">0032</span>  <span class="nf">CMPB</span>    <span class="nb">BX</span><span class="p">,</span><span class="kc">$</span><span class="mi">0</span>
</span><span class='line'><span class="err">0033</span>  <span class="nf">JEQ</span>     <span class="p">,</span><span class="mi">39</span>
</span><span class='line'><span class="err">0034</span>  <span class="nf">MOVB</span>    <span class="nb">AX</span><span class="p">,</span><span class="nb">BX</span>
</span><span class='line'><span class="err">0035</span>  <span class="nf">CMPB</span>    <span class="nb">BX</span><span class="p">,</span><span class="kc">$</span><span class="mi">2</span>
</span><span class='line'><span class="err">0036</span>  <span class="nf">JNE</span>     <span class="p">,</span><span class="mi">38</span>
</span><span class='line'><span class="err">0037</span>  <span class="nf">RET</span>     <span class="p">,</span>
</span><span class='line'><span class="err">0038</span>  <span class="nf">CALL</span>    <span class="p">,</span><span class="nv">runtime.throwinit</span><span class="o">+</span><span class="mi">0</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span>
</span><span class='line'><span class="err">0039</span>  <span class="nf">MOVB</span>    <span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="nv">initdone</span><span class="err">·</span><span class="o">+</span><span class="mi">0</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span>
</span><span class='line'><span class="err">0040</span>  <span class="nf">CALL</span>    <span class="p">,</span><span class="nv">fmt.init</span><span class="o">+</span><span class="mi">0</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span>
</span><span class='line'><span class="err">0041</span>  <span class="nf">MOVB</span>    <span class="kc">$</span><span class="mi">2</span><span class="p">,</span><span class="nv">initdone</span><span class="err">·</span><span class="o">+</span><span class="mi">0</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span>
</span><span class='line'><span class="err">0042</span>  <span class="nf">RET</span>     <span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>


<p>The data section &hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="err">---</span> <span class="nf">prog</span> <span class="nv">list</span> <span class="s">&quot;&lt;S&gt;&quot;</span> <span class="o">---</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">DATA</span>    <span class="nv">go.string.</span><span class="s">&quot;Hello, World&quot;</span><span class="o">+</span><span class="mi">0</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="kc">$</span><span class="nv">go.string.</span><span class="s">&quot;Hello, World&quot;</span><span class="o">+</span><span class="mi">12</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">DATA</span>    <span class="nv">go.string.</span><span class="s">&quot;Hello, World&quot;</span><span class="o">+</span><span class="mi">8</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="kc">$</span><span class="mi">12</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">DATA</span>    <span class="nv">go.string.</span><span class="s">&quot;Hello, World&quot;</span><span class="o">+</span><span class="mi">12</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="kc">$</span><span class="s">&quot;Hello, W&quot;</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">DATA</span>    <span class="nv">go.string.</span><span class="s">&quot;Hello, World&quot;</span><span class="o">+</span><span class="mi">20</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="kc">$</span><span class="s">&quot;orld&quot;</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">DATA</span>    <span class="nv">go.string.</span><span class="s">&quot;Hello, World&quot;</span><span class="o">+</span><span class="mi">24</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="kc">$</span><span class="mi">0</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">GLOBL</span>   <span class="nv">go.string.</span><span class="s">&quot;Hello, World&quot;</span><span class="o">+</span><span class="mi">0</span><span class="p">(</span><span class="nv">SB</span><span class="p">),</span><span class="mi">10</span><span class="p">,</span><span class="kc">$</span><span class="mi">32</span>
</span></code></pre></td></tr></table></div></figure>


<p>Omitted most of the rest of the data section, althought it has some weird stuff that I&rsquo;d like to dig into later, such as</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='nasm'><span class='line'><span class="nf">...</span>
</span><span class='line'><span class="nf">...</span>
</span><span class='line'><span class="nf">...</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">DATA</span>    <span class="nv">go.string.</span><span class="s">&quot;func(*uint8, string) interface {}&quot;</span><span class="o">+</span><span class="mi">0</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="kc">$</span><span class="nv">go.string.</span><span class="s">&quot;func(*uint8, string) interface {}&quot;</span><span class="o">+</span><span class="mi">12</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">DATA</span>    <span class="nv">go.string.</span><span class="s">&quot;func(*uint8, string) interface {}&quot;</span><span class="o">+</span><span class="mi">8</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="kc">$</span><span class="mi">33</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">DATA</span>    <span class="nv">go.string.</span><span class="s">&quot;func(*uint8, string) interface {}&quot;</span><span class="o">+</span><span class="mi">12</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="kc">$</span><span class="s">&quot;func(*ui&quot;</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">DATA</span>    <span class="nv">go.string.</span><span class="s">&quot;func(*uint8, string) interface {}&quot;</span><span class="o">+</span><span class="mi">20</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="kc">$</span><span class="s">&quot;nt8, str&quot;</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">DATA</span>    <span class="nv">go.string.</span><span class="s">&quot;func(*uint8, string) interface {}&quot;</span><span class="o">+</span><span class="mi">28</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="kc">$</span><span class="s">&quot;ing) int&quot;</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">DATA</span>    <span class="nv">go.string.</span><span class="s">&quot;func(*uint8, string) interface {}&quot;</span><span class="o">+</span><span class="mi">36</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="kc">$</span><span class="s">&quot;erface {&quot;</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">DATA</span>    <span class="nv">go.string.</span><span class="s">&quot;func(*uint8, string) interface {}&quot;</span><span class="o">+</span><span class="mi">44</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="kc">$</span><span class="s">&quot;}&quot;</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">DATA</span>    <span class="nv">go.string.</span><span class="s">&quot;func(*uint8, string) interface {}&quot;</span><span class="o">+</span><span class="mi">45</span><span class="p">(</span><span class="nv">SB</span><span class="p">)</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="kc">$</span><span class="mi">0</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">GLOBL</span>   <span class="nv">go.string.</span><span class="s">&quot;func(*uint8, string) interface {}&quot;</span><span class="o">+</span><span class="mi">0</span><span class="p">(</span><span class="nv">SB</span><span class="p">),</span><span class="mi">10</span><span class="p">,</span><span class="kc">$</span><span class="mi">48</span>
</span><span class='line'><span class="nf">...</span>
</span><span class='line'><span class="nf">...</span>
</span><span class='line'><span class="nf">...</span>
</span><span class='line'><span class="err">0043</span>  <span class="nf">END</span>     <span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>


<p>(What exactly is going on here ? Perhaps encoding strings to use for runtime error reporting ?)</p>

<h2>Running time</h2>

<p>Again, running a string output program for time comparison is stupid, but I can&rsquo;t help doing this stupid thing. So &hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">time</span> <span class="o">(</span><span class="k">while</span> <span class="o">((</span>n++ &lt; 100<span class="o">))</span><span class="p">;</span> <span class="k">do</span> ./helloworldgo<span class="p">;</span> <span class="k">done</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>real  0m0.567s
</span><span class='line'>user  0m0.196s
</span><span class='line'>sys   0m0.132s
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-03-12T00:00:00+00:00" pubdate data-updated="true">Mar 12<sup>th</sup>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/assembly/'>assembly</a>, <a class='category' href='/blog/categories/go/'>go</a>


</div>
	
</div>
</article>

<nav id="pagenavi">
    
        
            <a href="/posts//blog/page/8/" class="prev">Prev</a>
        
    
    
        <a href="/posts//blog/page/10/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    Agam

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'agamamp';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-16612682-4']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>
