
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Agam's Mashed-Up Pome</title>
	<meta name="author" content="Agam">

	
	<meta name="description" content="I looked around at the usual suspects (wordpress, blogspot, etc) but then stumbled across the recent static website idea when I read &ldquo;powerd &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Agam's Mashed-Up Pome" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>

</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Agam's Mashed-Up Pome</a></h1>
<!-- DebugAgam: Uncomment if necessary!
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:agam.github.io">
			</form>
		</div>
	</div>
</nav>
-->
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		<a class="google" href="https://plus.google.com/+AgamBrahma?rel=author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/agambrahma" title="Twitter">Twitter</a>
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
        <!-- DebugAgam: uncomment if necessary!
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:agam.github.io">
	</form>
        -->
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/12/22/beginning-with-hakyll/">
		
			Getting Up and Running With Hakyll</a>
	</h2>
	<div class="entry-content">
		<p>I looked around at the usual suspects (wordpress, blogspot, etc) but then stumbled across the recent static website idea when I read &ldquo;powerd by Jekyll&rdquo; in a blog footer. Soon enough I came across Hakyll, and decided to give it a go, if only to learn Haskell a bit better.</p>

<p>The first few examples I came across were hosted on Linode etc, so my initial plan was to use this new blog to try out another new (for me) tool and host it on Google Compute Engine. But after reading up a bit on that, I realized I didn&rsquo;t want to deal with provisioning and storage and all, and that&rsquo;s when I realized that I could just host it on a platform that already supports static websites: Github Pages.</p>

<p>So there are a few steps here: getting hakyll, setting it up for my blog, setting it up with github, etc, and I&rsquo;ll go over them, in no particular order.</p>

<h2>Getting Hakyll</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>cabal install hakyll
</span></code></pre></td></tr></table></div></figure>


<p>This will fetch al the required packages (and it took <em>quite</em> some time when I ran it, roughly as long as it might take <del>me</del>one to torrent an episode of a television series that <del>I am</del>one is currently watching). Of course, this depends on you already having <code>cabal</code> installed. If not, you should get the <a href="http://www.haskell.org/platform/">Haskell Platform</a> first.</p>

<p>If this works as intended, you should see a lot of output as <code>cabal</code> goes and compiles and installs a bunch of packages, ending with something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Installing library in /home/agam/.cabal/lib/hakyll-3.4.0.0/ghc-7.4.1
</span><span class='line'>Registering hakyll-3.4.0.0...
</span></code></pre></td></tr></table></div></figure>


<h2>Know how to use git and github</h2>

<p>I&rsquo;m assuming you have atleast an newbie level understanding of <a href="http://git-scm.com/">git</a> (which is what I have) and an account at <a href="http://www.github.com">github</a>.</p>

<p>This <a href="http://sixrevisions.com/resources/git-tutorials-beginners/">list of git tutorials</a> is a good starting point to learn git, though I recommend <a href="http://www-cs-students.stanford.edu/~blynn/gitmagic/">Git Magic</a> (if only because I know the author, and frankly I found other tutorials either shallow or boring, by comparison).</p>

<p>If you haven&rsquo;t used either git <em>or</em> github previously, I would recommend going through <a href="http://try.github.com/">Try Github</a> as it does a good job of walking you through the few core workflows you&rsquo;ll need to use.</p>

<h2>Know <strong>some</strong> haskell</h2>

<p>Ok, this is something I can&rsquo;t talk about here, mostly because I don&rsquo;t know it well myself, but also because it is really, really beyond the scope of this blog.</p>

<p>You can <a href="http://tryhaskell.org/">try haskell</a> for a while and come back; my personal opinion is that it&rsquo;s overhyped as being hard, while actually being sort of fun, and people who try to sell it to you as some mystical super-hard iq-prerequisite-required sort of thing are just $@#holes.</p>

<p>Still, you do need to know atleast some Haskell to use Hakyll, so I&rsquo;ll leave it at that.</p>

<h2>Set up github</h2>

<p>To host github pages, you need to create a repo of the form <code>username/username.github.com</code>. So <a href="https://github.com/new">do that now</a>.
The code for the site will live in a different repo (yeah, this part is a drag compared to Jekyll, where github &lsquo;automagically&rsquo; build the blog on commit, and then takes care of serving the right pages.</p>

<p>To get the same effect in our hakyll blog here, we&rsquo;ll have to set the pages repo as a <em>submodule</em> of the source repo. To do that, run</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git submodule add https://github.com/agam/agam.github.com.git _site
</span></code></pre></td></tr></table></div></figure>


<p>Don&rsquo;t forget to add the second argument specifying the folder that the submodule is embedded under.</p>

<p>If you leave this out, it will be embedded under the name of the repo (e.g. in this case, there would be a directory created called <code>agam.github.com</code>). I did this, and then had to do the following to get rid of it :&ndash;</p>

<p>(Thanks to <a href="http://stackoverflow.com/questions/1260748/how-do-i-remove-a-git-submodule">this stackoverflow post</a>!)</p>

<p>(1) Edit <code>.gitmodules</code> to remove the offending section. In my case, this showed up as</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>submodule <span class="s2">&quot;agam.github.com&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="nv">path</span> <span class="o">=</span> agam.github.com
</span><span class='line'>  <span class="nv">url</span> <span class="o">=</span> https://github.com/agam/agam.github.com.git
</span></code></pre></td></tr></table></div></figure>


<p>(2) Remove the corresponding section from <code>.git/config</code>. In my case, this showed up as</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>submodule <span class="s2">&quot;agam.github.com&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="nv">url</span> <span class="o">=</span> https://github.com/agam/agam.github.com.git
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>(3) Run <code>git rm</code> to remove the directory. Again, in my case, this meant running <code>git rm --cached agam.github.com</code></p>

<h2>Setting up hakyll: Overview</h2>

<p>Now for the actual structure of the blog, there are two ways to go: My plan is to go with the <a href="https://github.com/jaspervdj/hakyll-examples/tree/master/brochure">basic example</a> in the <a href="http://jaspervdj.be/hakyll/tutorials/02-basics.html">rudimentary hakyll docs</a> and build up from there to add support for multiple posts, pages, widgets, comments, etc.</p>

<p>The other option is to use one of the <a href="http://jaspervdj.be/hakyll/examples.html">existing large, customized hakyll blogs</a> and adapt them to your use.</p>

<p>Which option you use is up to you, the rest of this blog post talks about initial changes I made to the example site, and I&rsquo;ll mention any additional structural features in a separate blog post.</p>

<h2>Setting up hakyll: Details</h2>

<p>You can ignore this part really, if you&rsquo;ve successfully adapted the other blogs as mentioned above. I&rsquo;m taking the approach of starting with a single index page with a single post and building up from there.</p>

<p>So in the first iteration, I had a <code>css</code> folder (with the same contents as the example) and a <code>templates</code> folder (which contained a barebones <code>default.html</code>). I had a file <code>blog.hs</code> with this code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='haskell'><span class='line'><span class="cm">{-# LANGUAGE OverloadedStrings #-}</span>
</span><span class='line'>
</span><span class='line'><span class="kr">import</span> <span class="nn">Control.Arrow</span> <span class="p">((</span><span class="o">&gt;&gt;&gt;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="kr">import</span> <span class="nn">Hakyll</span>
</span><span class='line'>
</span><span class='line'><span class="nf">main</span> <span class="ow">::</span> <span class="kt">IO</span><span class="nb">()</span>
</span><span class='line'><span class="nf">main</span> <span class="ow">=</span> <span class="n">hakyll</span> <span class="o">$</span> <span class="kr">do</span>
</span><span class='line'>    <span class="n">match</span> <span class="s">&quot;images/*&quot;</span> <span class="o">$</span> <span class="kr">do</span>
</span><span class='line'>        <span class="n">route</span>    <span class="n">idRoute</span>
</span><span class='line'>        <span class="n">compile</span> <span class="n">copyFileCompiler</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">match</span> <span class="s">&quot;css/*&quot;</span> <span class="o">$</span> <span class="kr">do</span>
</span><span class='line'>        <span class="n">route</span>    <span class="n">idRoute</span>
</span><span class='line'>        <span class="n">compile</span> <span class="n">compressCssCompiler</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">match</span> <span class="s">&quot;templates/*&quot;</span> <span class="o">$</span> <span class="n">compile</span> <span class="n">templateCompiler</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">match</span> <span class="p">(</span><span class="n">list</span> <span class="p">[</span><span class="s">&quot;about.markdown&quot;</span><span class="p">,</span> <span class="s">&quot;index.markdown&quot;</span><span class="p">])</span> <span class="o">$</span> <span class="kr">do</span>
</span><span class='line'>        <span class="n">route</span>     <span class="o">$</span> <span class="n">setExtension</span> <span class="s">&quot;html&quot;</span>
</span><span class='line'>        <span class="n">compile</span>   <span class="o">$</span> <span class="n">pageCompiler</span>
</span><span class='line'>      <span class="o">&gt;&gt;&gt;</span> <span class="n">applyTemplateCompiler</span> <span class="s">&quot;templates/default.html&quot;</span>
</span><span class='line'>            <span class="o">&gt;&gt;&gt;</span> <span class="n">relativizeUrlsCompiler</span>
</span></code></pre></td></tr></table></div></figure>


<p>To generate the static html, run</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ghc --make blog.hs
</span></code></pre></td></tr></table></div></figure>


<p>(Now this is the point where the &lsquo;know some haskell&rsquo; rule applies, since if you&rsquo;re like me, you&rsquo;ll make some stupid typo and have to contend with something like</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Couldn<span class="s1">&#39;t match expected type `RulesM b0&#39;</span>
</span><span class='line'>            with actual <span class="nb">type</span> <span class="sb">`</span>cat0 a0 c0<span class="err">&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>and wonder <em>wtf</em> just happened &hellip; in this case, I hadn&rsquo;t indented the arrows between the compilers in the last two lines!)</p>

<p>If all goes well, you should see</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span><span class="m">1</span> of 1<span class="o">]</span> Compiling Main             <span class="o">(</span> blog.hs, blog.o <span class="o">)</span>
</span><span class='line'>Linking blog ...
</span></code></pre></td></tr></table></div></figure>


<p>Then, run</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>./blog build
</span></code></pre></td></tr></table></div></figure>


<p>(replace &lsquo;blog&rsquo; with whatever <code>foo.hs</code> contains the &lsquo;main&rsquo; function)</p>

<p>This is where I encountered another error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>  <span class="o">[</span> ERROR<span class="o">]</span> Hakyll.Web.readPandocWith: I don<span class="err">&#39;</span>t know how to <span class="nb">read </span>a file of the <span class="nb">type </span>Binary <span class="k">for</span>: about.pandoc
</span></code></pre></td></tr></table></div></figure>


<p>(Once again, my typo: I had used <code>about.pandoc</code> when I meant to say, of course, <code>about.markdown</code>. Recompiled, built, saw the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Initialising
</span><span class='line'>  <span class="o">[</span>   0ms<span class="o">]</span> Creating store
</span><span class='line'>  <span class="o">[</span>  15ms<span class="o">]</span> Creating provider
</span><span class='line'>Adding new compilers
</span><span class='line'>Compiling templates/default.html
</span><span class='line'>  <span class="o">[</span>      <span class="o">]</span> Checking cache: OK
</span><span class='line'>  <span class="o">[</span>   0ms<span class="o">]</span> Total compile <span class="nb">time</span>
</span><span class='line'>Compiling about.markdown
</span><span class='line'>  <span class="o">[</span>      <span class="o">]</span> Checking cache: modified
</span><span class='line'>  <span class="o">[</span>   1ms<span class="o">]</span> Total compile <span class="nb">time</span>
</span><span class='line'>  <span class="o">[</span>   0ms<span class="o">]</span> Routing to about.html
</span><span class='line'>Compiling css/default.css
</span><span class='line'>  <span class="o">[</span>   1ms<span class="o">]</span> Total compile <span class="nb">time</span>
</span><span class='line'>  <span class="o">[</span>   0ms<span class="o">]</span> Routing to css/default.css
</span><span class='line'>Compiling css/syntax.css
</span><span class='line'>  <span class="o">[</span>   1ms<span class="o">]</span> Total compile <span class="nb">time</span>
</span><span class='line'>  <span class="o">[</span>   0ms<span class="o">]</span> Routing to css/syntax.css
</span><span class='line'>Compiling index.markdown
</span><span class='line'>  <span class="o">[</span>      <span class="o">]</span> Checking cache: modified
</span><span class='line'>  <span class="o">[</span>  31ms<span class="o">]</span> Total compile <span class="nb">time</span>
</span><span class='line'>  <span class="o">[</span>   0ms<span class="o">]</span> Routing to index.html
</span></code></pre></td></tr></table></div></figure>


<p>So if you see any errors, <strong>Don&rsquo;t Panic</strong>. It&rsquo;ll turn out to have a simple explanation.)</p>

<p>You can also, at this point, run <code>./blog preview</code>, and then <a href="http://0.0.0.0:8000">check it out</a> in your browser.</p>

<h2>Pushing to Github</h2>

<p>Ok, so the blog&rsquo;s basically one stupid black-and-white single page (no problem, we&rsquo;ll add to that later). To get this basic example up and running, make sure you <code>git add</code> all the files you created.</p>

<p>In general, this will be a 4 step process:&ndash;</p>

<ol>
<li>Edit posts</li>
<li><code>blog build</code> to generate site contents inside _site (replace <code>blog</code> with whatever you call your <code>.hs</code> file)</li>
<li><code>cd _site</code> then <code>git add -i</code> and <code>git commit -m "new post etc"</code> and <code>git push origin master</code>. The blog is now live on Github Pages!</li>
<li><code>cd ..</code> followed by another commit and push to check in your modified post(s)</li>
</ol>


<hr />

<p>For reference, my hakyll source lives <a href="https://github.com/agam/hakyll-source">here</a> and the static website is generated <a href="https://github.com/agam/agam.github.com">here</a></p>

<p><em>Continue on to <a href="/blog/2013/01/04/hakyll-multiple-posts-and-more/">part 2</a></em></p>

<p><em><strong>Update</strong></em>: Since the writing of this post, Hakyll has gone from 3.x to 4.x and changed its DSL significantly (see <a href="/posts/hakyll-broken.html">a post on that</a>).</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-12-22T00:00:00-08:00" pubdate data-updated="true">Dec 22<sup>nd</sup>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/github/'>github</a>, <a class='category' href='/blog/categories/hakyll/'>hakyll</a>


</div>
	
</div>
</article>

<nav id="pagenavi">
    
        
            <a href="/posts//blog/page/16/" class="prev">Prev</a>
        
    
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2016

    Agam

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'agamamp';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-16612682-4']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>
